<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1 Introduction &mdash; Ndigo 1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="1. Packet Format" href="Ndigo_PackForm.html" />
    <link rel="prev" title="Welcome to Ndigo’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Ndigo
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Home</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><span class="sectnum">1</span> Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#features"><span class="sectnum">1.1</span> Features</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#hardware"><span class="sectnum">2</span> Hardware</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installing-the-board"><span class="sectnum">2.1</span> Installing the Board</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ndigo5g-external-inputs-and-connectors"><span class="sectnum">2.2</span> Ndigo5G External Inputs and Connectors</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#connectors"><span class="sectnum">2.2.1</span> Connectors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analog-inputs"><span class="sectnum">2.2.2</span> Analog Inputs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#analog-offsets"><span class="sectnum">2.2.2.1</span> Analog Offsets</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#digital-inputs"><span class="sectnum">2.2.3</span> Digital Inputs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#tdc-on-trigger-input"><span class="sectnum">2.2.3.1</span> TDC on Trigger Input</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#extension-card"><span class="sectnum">2.3</span> Extension Card</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ndigo5g-functionality"><span class="sectnum">2.4</span> Ndigo5G Functionality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adc-modes"><span class="sectnum">2.4.1</span> ADC Modes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#channel-modes-a-b-c-and-d"><span class="sectnum">2.4.1.1</span> 1 Channel Modes A, B, C and D</a></li>
<li class="toctree-l4"><a class="reference internal" href="#channel-modes-ac-bc-ad-and-bd"><span class="sectnum">2.4.1.2</span> 2 Channel Modes AC, BC, AD and BD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#channel-mode-abcd"><span class="sectnum">2.4.1.3</span> 4 Channel Mode ABCD</a></li>
<li class="toctree-l4"><a class="reference internal" href="#multiple-sampling-modes-aaaa-bbbb-cccc-and-dddd"><span class="sectnum">2.4.1.4</span> Multiple Sampling Modes AAAA, BBBB, CCCC and DDDD</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#zero-suppression"><span class="sectnum">2.4.2</span> Zero Suppression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#trigger-blocks"><span class="sectnum">2.4.3</span> Trigger Blocks</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#driver-programming-api"><span class="sectnum">3</span> Driver Programming API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#constants"><span class="sectnum">3.1</span> Constants</a></li>
<li class="toctree-l2"><a class="reference internal" href="#initialization"><span class="sectnum">3.2</span> Initialization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#structure-ndigo-init-parameters"><span class="sectnum">3.2.1</span> Structure ndigo_init_parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#status-information"><span class="sectnum">3.3</span> Status Information</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#functions-for-information-retrieval"><span class="sectnum">3.3.1</span> Functions for Information Retrieval</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#structure-ndigo-static-info"><span class="sectnum">3.4</span> Structure ndigo_static_info</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#structure-ndigo-param-info"><span class="sectnum">3.4.1</span> Structure ndigo_param_info</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-ndigo-fast-info"><span class="sectnum">3.4.2</span> Structure ndigo fast info</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-ndigo-slow-info"><span class="sectnum">3.4.3</span> Structure ndigo slow info</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration"><span class="sectnum">3.5</span> Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#structure-ndigo-configuration"><span class="sectnum">3.5.1</span> Structure ndigo configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-ndigo-trigger"><span class="sectnum">3.5.2</span> Structure ndigo trigger</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-ndigo-trigger-block"><span class="sectnum">3.5.3</span> Structure ndigo_trigger_block</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-ndigo-gating-block"><span class="sectnum">3.5.4</span> Structure ndigo gating block</a></li>
<li class="toctree-l3"><a class="reference internal" href="#structure-ndigo-extension-block"><span class="sectnum">3.5.5</span> Structure ndigo extension block</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-time-control"><span class="sectnum">3.5.6</span> Run Time Control</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#readout"><span class="sectnum">3.6</span> Readout</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-structure-ndigo-read-in"><span class="sectnum">3.6.1</span> Input Structure ndigo read in</a></li>
<li class="toctree-l3"><a class="reference internal" href="#input-structure-ndigo-read-out"><span class="sectnum">3.6.2</span> Input Structure ndigo read out</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#other-functions"><span class="sectnum">3.7</span> Other Functions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#led-control"><span class="sectnum">3.7.1</span> LED control</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#packet-format"><span class="sectnum">4</span> Packet Format</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#output-structure-ndigopacket"><span class="sectnum">4.1</span> Output Structure ndigopacket</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#c-example"><span class="sectnum">5</span> C-Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="#technical-data"><span class="sectnum">6</span> Technical Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#digitizer-characteristics"><span class="sectnum">6.1</span> Digitizer Characteristics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#channel-mode-5gsps"><span class="sectnum">6.1.1</span> 1-Channel-Mode (5Gsps)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#channel-mode-2-5-gsps"><span class="sectnum">6.1.2</span> 2-Channel-Mode (2.5 Gsps)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#channel-mode-1-25-gsps"><span class="sectnum">6.1.3</span> 4-Channel-Mode (1.25 Gsps)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#electrical-characteristics"><span class="sectnum">6.2</span> Electrical Characteristics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#oscillator"><span class="sectnum">6.2.1</span> Oscillator</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environmental-conditions-for-operation"><span class="sectnum">6.2.2</span> Environmental Conditions for Operation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environmental-conditions-for-storage"><span class="sectnum">6.2.3</span> Environmental Conditions for Storage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#power-supply"><span class="sectnum">6.2.4</span> Power Supply</a></li>
<li class="toctree-l3"><a class="reference internal" href="#analog-input"><span class="sectnum">6.2.5</span> Analog Input</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id89"><span class="sectnum">6.2.6</span> Analog inputs</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#information-required-by-din-en-61010-1"><span class="sectnum">6.3</span> Information Required by DIN EN 61010-1</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#manufacturer"><span class="sectnum">6.3.1</span> Manufacturer</a></li>
<li class="toctree-l3"><a class="reference internal" href="#intended-use-and-system-integration"><span class="sectnum">6.3.2</span> Intended Use and System Integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cooling"><span class="sectnum">6.3.3</span> Cooling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environmental-conditions"><span class="sectnum">6.3.4</span> Environmental Conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inputs"><span class="sectnum">6.3.5</span> Inputs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#known-bugs"><span class="sectnum">6.3.6</span> Known Bugs</a></li>
<li class="toctree-l3"><a class="reference internal" href="#workarounds"><span class="sectnum">6.3.7</span> Workarounds</a></li>
<li class="toctree-l3"><a class="reference internal" href="#recycling"><span class="sectnum">6.3.8</span> Recycling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#export-control"><span class="sectnum">6.3.9</span> Export Control</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#revision-history"><span class="sectnum">7</span> Revision History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#firmware"><span class="sectnum">7.1</span> Firmware</a></li>
<li class="toctree-l2"><a class="reference internal" href="#driver-applications"><span class="sectnum">7.2</span> Driver &amp; Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="#user-guide"><span class="sectnum">7.3</span> User Guide</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Ndigo_PackForm.html">1. Packet Format</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Ndigo_CExp.html">1. C-Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Ndigo_Tech.html">1. Technical Data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Ndigo_RevHistory.html">1. Revision History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ndigo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active"><span class="sectnum">1</span> Introduction</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Ndigo_Intro.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="introduction">
<h1><span class="sectnum">1</span> Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading"></a></h1>
<link rel="stylesheet" type="text/css" href="_static/style.css"/><p>(see <a class="reference external" href="#target-link1">Fig</a> ).</p>
<p>The <strong>Ndigo5G</strong> is a digitizer and transient recorder designed to sample
relatively shorts pulses in rapid repetition. It produces a stream of
output packets, each containing data from a single trigger event
together with a timestamp.</p>
<p>By default the <strong>Ndigo5G</strong> is equipped with a passive cooling system. If
necessary, the unit might be ordered with an active cooling system on demand ( <a class="reference external" href="#target-link1">see Figure 1.1</a> ).</p>
<section id="features">
<h2><span class="sectnum">1.1</span> Features<a class="headerlink" href="#features" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><strong>10 bit</strong> dynamic range</p></li>
<li><p>up to <strong>5 Gsps</strong> sample rate (in 1 channel mode) for increased resolution in time domain.</p></li>
<li><p>up to <strong>4 channels</strong> for your individual measurement setups.</p></li>
<li><p>digital input with TDC that can also be used for gating and
triggering.</p></li>
<li><p>2<sup>nd</sup> digital input for gating or triggering.</p></li>
<li><p>PCIe 4x 1.1 with <strong>800 MB/s throughput</strong> for simple and fast data transfer to most PCs.</p></li>
<li><p>multiple boards can be synchronized via reference clock if more channels are required.</p></li>
<li><p>extension board available with 4 additional digital inputs.</p></li>
</ul>
<p>This is a reference to <span class="xref std std-ref">my_figure</span>.</p>
<br><figure class="align-default" id="id90">
<span id="target-link1"></span><a class="reference internal image-reference" href="_images/fig1.1.png"><img alt="alternative text" src="_images/fig1.1.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Figure 107: Figure 1.1: Ndigo5G equipped with active cooling system</span><a class="headerlink" href="#id90" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="hardware">
<h1><span class="sectnum">2</span> Hardware<a class="headerlink" href="#hardware" title="Permalink to this heading"></a></h1>
<section id="installing-the-board">
<h2><span class="sectnum">2.1</span> Installing the Board<a class="headerlink" href="#installing-the-board" title="Permalink to this heading"></a></h2>
<p>The <strong>Ndigo5G board</strong> can be installed in any x4 (or higher amount of lanes)
PCIe slot. If the slot electrically supports less than 4 lanes, the
board will operate at lowerdata throughput rates.</p>
<p>Please ensure proper cooling of the device. The <strong>Ndigo5G</strong> has an onboard
temperature detection. If the ADC chip temperature exceeds
90C a warning is issued to the device driver. In
case the temperature is higher than 95C the ADC is
disabled to avoid damage. Using a PCI-slot cooler is in many cases an
appropriate solution to circumvent problems caused by overheating if the
board is used inside a PC. The Ndigo-Crate will provide sufficient
cooling under normal operating conditions.</p>
<p>Using a single <strong>Ndigo5G</strong>, no further connections need to be made.</p>
<p>For applications that require more than 4 ADC channels, several Ndigo boards
can be operated in sync. Any board of the <strong>Ndigo product line</strong> can be
synced to other Ndigo boards, allowing, for instance, for a combination
of high speed ADCs (<strong>Ndigo5G</strong>) and slower high resolution ADCs
(<strong>Ndigo250M-14</strong>).</p>
<p>The signals used for board synchronization and inter-board triggering
are transferred on a bus be-tween the boards. Join all C2 connectors
(see <a class="reference external" href="#target-link2">Figure 2.3</a>  on page 7) on the
boards using a ribbon cable. Both ends of the bus need to be terminated
properly. If using a <strong>Ndigo Crate</strong>, connectors providing the termination
are located on the crate mainboard next to the PCIe slots to the extreme
left and right. &lt;more details, peas.e refer to the Ndigo Crate user
guide. In applications that use only a few Ndigo boards installed
directly inside a PC, termination PCBs available from cronologic can be
used.</p>
<p><strong>Ndigo5G’s</strong> standard device driver can be used to read out all boards and
acquire data. For more complex scenarios, using the cronoSync-library,
which is part of cronoTools, is recommended. The cronoSync library is
provided with the Ndigo device driver. Please refer to the cronoTools
user guide for more information.</p>
<figure class="align-default" id="id91">
<a class="reference internal image-reference" href="_images/fig2.1.png"><img alt="alternative text" src="_images/fig2.1.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">Figure 108: Figure 2.1: If several Ndigo boards are connected to work in sync, the boards
must be connected using a ribbon cable as bus for synchronization and
trigger signals. Proper termination is required at both ends of the cable.</span><a class="headerlink" href="#id91" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="ndigo5g-external-inputs-and-connectors">
<h2><span class="sectnum">2.2</span> Ndigo5G External Inputs and Connectors<a class="headerlink" href="#ndigo5g-external-inputs-and-connectors" title="Permalink to this heading"></a></h2>
<section id="connectors">
<h3><span class="sectnum">2.2.1</span> Connectors<a class="headerlink" href="#connectors" title="Permalink to this heading"></a></h3>
<p>The inputs of the <strong>Ndigo5G</strong> are located on the PCI bracket. Figure
<a class="reference external" href="#target-link2">Figure 2.3</a> on page 7 shows the location of the
4 analog inputs A to D and the two digital inputs G (GATE) and T
(Trigger). Furthermore, two board interconnection connectors can be
found at the top edge of the <strong>Ndigo5G</strong>, as displayed in
<a class="reference external" href="#target-link2">Figure 2.3</a> on page 7. Connector C1 is used
for a board-to-board connection (e. g. to link a HPTDC8-PCI and a
<strong>Ndigo5G</strong> via a <strong>Ndigo Extension board</strong>, see chapter 2.3).
Connector C2 is used as a bus interface
between multiple Ndigo boards distributing clock, trigger and sync
signals. Proper termination must be placed at both ends of the bus
interconnection ribbon cable.</p>
<figure class="align-default" id="id92">
<a class="reference internal image-reference" href="_images/fig2.2.png"><img alt="alternative text" src="_images/fig2.2.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">Figure 109: Figure 2.2: Input connectors of an Ndigo5G located on the PCI bracket.</span><a class="headerlink" href="#id92" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id93">
<span id="target-link2"></span><a class="reference internal image-reference" href="_images/fig2.3.png"><img alt="alternative text" src="_images/fig2.3.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Figure 110: Figure 2.3: Ndigo5G board showing inter-board connectors C1 and C2.</span><a class="headerlink" href="#id93" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="analog-inputs">
<h3><span class="sectnum">2.2.2</span> Analog Inputs<a class="headerlink" href="#analog-inputs" title="Permalink to this heading"></a></h3>
<figure class="align-default" id="id94">
<a class="reference internal image-reference" href="_images/fig2.4.png"><img alt="alternative text" src="_images/fig2.4.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Figure 111: Figure 2.3: Input circuit for each of the four analog channels.</span><a class="headerlink" href="#id94" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The analog inputs of the ADC are single ended LEMO00 coax connectors.
The inputs have a <span class="math notranslate nohighlight">\(50\Omega\)</span> impedance and are AC coupled. The
inputs are converted to a differential signal using a balun.</p>
<section id="analog-offsets">
<h4><span class="sectnum">2.2.2.1</span> Analog Offsets<a class="headerlink" href="#analog-offsets" title="Permalink to this heading"></a></h4>
<p>AC coupling removes the common mode voltage from the input signal. Users
can move the common mode voltage to a value of their choice using the
analogoffset parameter of each channel before sampling.</p>
<p>This feature is useful for highly asymmetric signals, such as pulses
from TOF spectrometers or LIDAR systems. Without analog offset
compensation, the pulses would begin in the middle of the ADC range,
effectively cutting the dynamic range in half (see <a class="reference external" href="#target-link3">Figure 2.6</a> ). By shifting the DC baseline to
one end of the ADC range, the input range can be used fully, providing
the maximum dynamic range. The analog offset can be set between
<span class="math notranslate nohighlight">\(\pm 0,25V\)</span>.</p>
<figure class="align-default" id="id95">
<a class="reference internal image-reference" href="_images/fig2.5.png"><img alt="alternative text" src="_images/fig2.5.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Figure 112: Figure 2.5: Users can add analog offset to the input before sampling</span><a class="headerlink" href="#id95" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id96">
<span id="target-link3"></span><a class="reference internal image-reference" href="_images/fig2.6.png"><img alt="alternative text" src="_images/fig2.6.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Figure 113: Figure 2.6: Asymmetric signal shifted to increase dynamic range</span><a class="headerlink" href="#id96" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="digital-inputs">
<h3><span class="sectnum">2.2.3</span> Digital Inputs<a class="headerlink" href="#digital-inputs" title="Permalink to this heading"></a></h3>
<p>There are two digital inputs on the front slot cover called Trigger and
GATE.</p>
<p>Both inputs provide a digital input signal routed to the trigger matrix.
These signals can be used to trigger any of the trigger state machines
and gating blocks. The inputs are AC coupled. DC offset is configurable
via  <strong>dc_offset_parameter</strong> in the <strong>configurations structure</strong> to
support positive and negative input pulses.</p>
<p>The configuration is set via the structures <strong>trigger[8] and trigger[9]</strong> in
the <strong>configuration structure</strong>.The input circuit is shown in
Figure 2.17  on page 15.</p>
<section id="tdc-on-trigger-input">
<h4><span class="sectnum">2.2.3.1</span> TDC on Trigger Input<a class="headerlink" href="#tdc-on-trigger-input" title="Permalink to this heading"></a></h4>
<p>There is a TDC connected to the Trigger input. When used with the TDC,
the Trigger input supports negative pulses only . The TDC creates
packets of <strong>type 8</strong>. These packets first contain a coarse timestamp and a
payload that can be used to calculate the trigger position with higher
precision. The function <strong>ndigo_process_tdc_packet()</strong> can be used to replace
the coarse timestamp with the precise timestamp. This function is
described in section 3.5 on page 40 . TDC pulses
must have a minimum duration of 3.3ns. The dead-time of the TDC is 32ns.</p>
</section>
</section>
</section>
<section id="extension-card">
<h2><span class="sectnum">2.3</span> Extension Card<a class="headerlink" href="#extension-card" title="Permalink to this heading"></a></h2>
<p>The Ndigo Extension card provides additional inputs or outputs to the
FPGA. It is connected to the C1(Samtec QSS-025) connector on an <strong>Ndigo5G</strong> by
an Samtec SQCD cable assembly.</p>
<p>The <strong>Ndigo Extension Card</strong> provides up to ten single ended LEMO00
connectors. The circuit connecting to each of these circuits can be
chosen to provide inputs or outputs. These can be AC or DC coupled. AC
coupled inputs support NIM signaling.</p>
<p>The signals connect to 2.5V IO Pins of the Xilinx Virtex-5 FPGA.
The current firmware revision provides the following signal connections.</p>
<div class="small docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 17%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Connector</p></th>
<th class="head"><p>QSS Pin</p></th>
<th class="head"><p>FPGA Pin</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Signal</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>LEMO00: CH0</p></td>
<td><p>22</p></td>
<td><p>AD9</p></td>
<td><p>Input</p></td>
<td><p>Ndigo Extension
digital channel
0</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH1</p></td>
<td><p>18</p></td>
<td><p>AE10</p></td>
<td><p>Input</p></td>
<td><p>Ndigo Extension
digital channel
1</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH2</p></td>
<td><p>14</p></td>
<td><p>D10</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>not connected</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH3</p></td>
<td><p>10</p></td>
<td><p>AF9</p></td>
<td><p>Output</p></td>
<td><p>39.0625 MHz
clock for HPTDC</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH4</p></td>
<td><p>6</p></td>
<td><p>AD11</p></td>
<td><p>Output</p></td>
<td><p>39.0625 MHz
clock for HPTDC</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH5</p></td>
<td><p>5</p></td>
<td><p>AE7</p></td>
<td><p>Output</p></td>
<td><p>39.0625 MHz
clock for HPTDC</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH6</p></td>
<td><p>9</p></td>
<td><p>AF7</p></td>
<td><p>Output</p></td>
<td><p>39.0625 MHz
clock for HPTDC</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH7</p></td>
<td><p>13</p></td>
<td><p>D9</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>not connected</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH8</p></td>
<td><p>17</p></td>
<td><p>V9</p></td>
<td><p>Input</p></td>
<td><p>Ndigo Extension
digital channel
2</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH9</p></td>
<td><p>21</p></td>
<td><p>W9</p></td>
<td><p>Input</p></td>
<td><p>Ndigo Extension
digital channel
3</p></td>
</tr>
<tr class="row-even"><td><p>SYNC1:
Sync-TDC8</p></td>
<td><p>26</p></td>
<td><p>F9</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>not connected</p></td>
</tr>
<tr class="row-odd"><td><p>SYNC1:
Sync-HPTDC</p></td>
<td><p>44</p></td>
<td><p>AA7</p></td>
<td><p>Output</p></td>
<td><p>Sync for HPTDC</p></td>
</tr>
</tbody>
</table>
</div>
<p>The 4 digital inputs are routed to the bus inputs of the trigger matrix
to be used for triggering. The routing can be configured to either ORing
the sync bus and extension channels or use the extension channels
exclusively.</p>
<div class="small docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 22%" />
<col style="width: 34%" />
<col style="width: 28%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Connector</p></td>
<td><p>Extension Card</p></td>
<td><p>Trigger matrix input</p></td>
<td><p>Trigger matrix input</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Digital Channel</p></td>
<td><p>ignorecable = 0</p></td>
<td><p>ignorecable = 1</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH0</p></td>
<td><p>0</p></td>
<td><p>BUS0 = EXT0  Sync Cable 0</p></td>
<td><p>BUS0 = EXT0</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH1</p></td>
<td><p>1</p></td>
<td><p>BUS1 = EXT1  Sync Cable 1</p></td>
<td><p>BUS1 = EXT1</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH8</p></td>
<td><p>2</p></td>
<td><p>BUS2 = EXT2  Sync Cable 2</p></td>
<td><p>BUS2 = EXT2</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH9</p></td>
<td><p>3</p></td>
<td><p>BUS3 = EXT3  Sync Cable 3</p></td>
<td><p>BUS3 = EXT3</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="ndigo5g-functionality">
<h2><span class="sectnum">2.4</span> Ndigo5G Functionality<a class="headerlink" href="#ndigo5g-functionality" title="Permalink to this heading"></a></h2>
<section id="adc-modes">
<h3><span class="sectnum">2.4.1</span> ADC Modes<a class="headerlink" href="#adc-modes" title="Permalink to this heading"></a></h3>
<p>Depending on board configuration, the analog input signal is quantized
to 8 or 10 bits. However, the board always scales and offsets the data
to 16 bit signed data centered around 0.</p>
<p>Data processing such as trigger detection or packet building are always
performed on <strong>3.2ns</strong> intervals. Depending on the ADC mode, this interval
may contain 4, 8 or 16 samples.</p>
<p>The board supports using one, two or four channels:</p>
<section id="channel-modes-a-b-c-and-d">
<h4><span class="sectnum">2.4.1.1</span> 1 Channel Modes A, B, C and D<a class="headerlink" href="#channel-modes-a-b-c-and-d" title="Permalink to this heading"></a></h4>
<p>In these modes, only a single channel is used. The analog signal on that
channel is digitized at 5Gsps. Packet size is always a multiple of 16
samples per <strong>3.2ns</strong> . See <a class="reference external" href="#target-link5">Figure 2.9</a>
on page and  ` Fig2.15  &lt;#target-link6&gt;`_ on page.</p>
</section>
<section id="channel-modes-ac-bc-ad-and-bd">
<h4><span class="sectnum">2.4.1.2</span> 2 Channel Modes AC, BC, AD and BD<a class="headerlink" href="#channel-modes-ac-bc-ad-and-bd" title="Permalink to this heading"></a></h4>
<p>In these modes, two channels are used simultaneously. The analog signals
on these channels are digitized at <strong>2.5Gsps</strong> each. Packet size is always a
multiple of 8 samples per <strong>3.2ns</strong>. See <a class="reference external" href="#target-link7">Fig2.8</a> on page 11
and see ` Fig2.14 &lt;#target-link8&gt;`_ on page 14.</p>
</section>
<section id="channel-mode-abcd">
<h4><span class="sectnum">2.4.1.3</span> 4 Channel Mode ABCD<a class="headerlink" href="#channel-mode-abcd" title="Permalink to this heading"></a></h4>
<p>In this mode, all four channels are digitized independently at <strong>1.25Gsps</strong>
each. The packet size is always a multiple of 4 samples per <strong>3.2ns</strong>. See
<a class="reference external" href="#target-link9">Fig2.7</a> on page 11 and see ` Fig2.13 &lt;#target-link10&gt;`_ on page 14.</p>
</section>
<section id="multiple-sampling-modes-aaaa-bbbb-cccc-and-dddd">
<h4><span class="sectnum">2.4.1.4</span> Multiple Sampling Modes AAAA, BBBB, CCCC and DDDD<a class="headerlink" href="#multiple-sampling-modes-aaaa-bbbb-cccc-and-dddd" title="Permalink to this heading"></a></h4>
<p>In these modes, only one analog input channel is used, but the channel is sampled independently
and simultaneously by four ADCs at <strong>1.25Gsps</strong>.The board creates four independent streams with
4 samples each per <strong>3.2ns</strong>.</p>
<p>Using the same trigger setting on all ADCs, can be used to reduce noise
by averaging the four channels. To deal with complex triggering
conditions, different trigger settings on each of the ADCs can be used.</p>
<p>The <strong>Ndigo5G</strong> provides 4 ADCs sampling at <strong>1.25Gsps</strong> each. Higher speed
modes are implemented by interleaving two or four of these ADCs.</p>
<p>During interleaving, the <strong>Ndigo5G</strong> firmware reorders and groups the data
into a linear sample stream. The process is fully transparent. For
users, the only difference is that a <strong>3.2ns</strong> cycle can contain 4, 8 or 16
samples, depending on mode.</p>
<figure class="align-default" id="id97">
<span id="target-link9"></span><a class="reference internal image-reference" href="_images/fig2.7.png"><img alt="alternative text" src="_images/fig2.7.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 8 </span><span class="caption-text">Figure 114: Figure 2.7: ADCs in 4 channel mode ABCD at 1.25Gsps.</span><a class="headerlink" href="#id97" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id98">
<span id="target-link7"></span><a class="reference internal image-reference" href="_images/fig2.8.png"><img alt="alternative text" src="_images/fig2.8.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 9 </span><span class="caption-text">Figure 115: Figure 2.8: ADCs in 2 channel mode AD, interleaved for 2.5Gsps.</span><a class="headerlink" href="#id98" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id99">
<span id="target-link5"></span><a class="reference internal image-reference" href="_images/fig2.9.png"><img alt="alternative text" src="_images/fig2.9.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 10 </span><span class="caption-text">Figure 116: Figure 2.9: ADCs in 1 channel mode A, B, C or D interleaved for 5Gsps.</span><a class="headerlink" href="#id99" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="zero-suppression">
<h3><span class="sectnum">2.4.2</span> Zero Suppression<a class="headerlink" href="#zero-suppression" title="Permalink to this heading"></a></h3>
<p>One of <strong>Ndigo5G’s</strong> key features is on-board zero suppression to reduce
PCIe bus load. Only data that passes specifications predefined by the
user is transmitted. This guide refers to transmitted waveform data as
“packets”. A packet contains the waveform data and a timestamp giving
the absolute time (i.e. the time since start of data acquisition) of the
packet’s last sample.</p>
<p>` Fig2.10 &lt;#target-link11&gt;`_ shows a simple example: Data
is written to the PC only if values exceed a specified threshold.
Expanding on that, <strong>Ndigo5G’s</strong> zero suppression can be used to realize
much more complex scenarios.</p>
<figure class="align-default" id="id100">
<span id="target-fig8"></span><a class="reference internal image-reference" href="_images/fig2.10.png"><img alt="alternative text" src="_images/fig2.10.png" style="width: 1300px; height: 900px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 11 </span><span class="caption-text">Figure 117: Figure 2.10: Simple zero suppression: Only data
with values above a threshold are written to the PC.</span><a class="headerlink" href="#id100" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="trigger-blocks">
<h3><span class="sectnum">2.4.3</span> Trigger Blocks<a class="headerlink" href="#trigger-blocks" title="Permalink to this heading"></a></h3>
<p><strong>Ndigo5G-10</strong> and <strong>Ndigo5G-8</strong> record analog waveforms using zero suppression.
Whenever a relevant waveform is detected, data is written to an internal
FIFO memory. Each ADC channel has one trigger block determining whether
data is written to the FIFO. The parameters are set in Structure
<strong>ndigo_trigger_block</strong> (See chapter 3.4.3 on page 36).</p>
<p>Each trigger block consists of two independent units that check the
incoming raw data stream for trigger conditions ( ` Fig2.10 &lt;#target-link11&gt;`_ on page 12). Users can specify a
threshold and can choose whether triggering is used whenever incoming
data is below or above the threshold (level triggering) or only if data
exceeds the threshold (edge triggering).</p>
<p>A gate length can be set to extend the trigger window by multiples of
<strong>3.2ns</strong>. Furthermore, if users choose precursor values &gt; 0, the
trigger unit will start writing data to the FIFO precursor
3:2ns before the trigger event.</p>
<p>When using edge triggering, all packets have the same length ( ` Fig2.11 &lt;#target-link12&gt;`_ on page 13):
precursor + length + 1 cycles of <strong>3.2ns</strong>. For level
triggering, packet length is data dependent ( ` Fig 2.12 &lt;#target-link13&gt;`_ on page 14).</p>
<p>Please note that triggering is not accurate to sample. For each <strong>3.2ns</strong>
clock cycle, it is determined whether on any sample during that clock
cycle a trigger condition is met. The clock cycle is then selected as
the trigger point. As a result, the trigger sample can be anywhere
within a range of up to 16 samples in single channel mode ( ` Fig2.15 &lt;#target-link6&gt;`_
on page 15 ) at 16 samples per <strong>3.2ns</strong> .</p>
<p>If retriggering is active, the current trigger window is extended if a
trigger event is detected inside the window.</p>
<p>A trigger block can use several input sources:</p>
<ul class="simple">
<li><p>the 8 trigger decision units of all four ADC channels ( ` Fig2.16 &lt;#target-link14&gt;`_  on page 15)</p></li>
<li><p>the GATE input (` Fig2.17 &lt;#target-link4&gt;`_ on page 15)</p></li>
<li><p>the Trigger or TDC input, (` Fig2.17 &lt;#target-link4&gt;`_ on page 15 )</p></li>
<li><p>a function trigger providing random or periodic triggering (Section 2.4.5
on page 20)</p></li>
<li><p>triggers originating from other cards connected with the sync cable
or from the Ndigo Extension card (BUS0, BUS1, BUS2, BUS3)</p></li>
<li><p>A second set of trigger units with names ending in pe for the digital
inputs Trigger, GATE, BUS0, BUS1, BUS2, and BUS3 configured for
positive edge triggering. Together with the regular trigger units on
this inputs, both edges of a pulse can be used in the trigger logic.
This set of triggers is not available as inputs for the gate blocks.</p></li>
</ul>
<p>Trigger inputs from the above sources can be concatenated using logical
OR ( ` Fig 2.19 &lt;#target-link15&gt;`_ on page 16) by
setting the appropriate bits in the trigger blocks source mask.</p>
<p>Triggers can be fed into the gate blocks described on page ( ` Fig 2.20 &lt;#target-link16&gt;`_ Gate blocks can be used to
block writing data to the FIFO. That way, only zero suppressed data
occurring when the selected gate is active is transmitted. This
procedure reduces PCIe bus load even further ( ` Fig 2.20 &lt;#target-link16&gt;`_ ).</p>
<figure class="align-default" id="id101">
<span id="target-link12"></span><a class="reference internal image-reference" href="_images/fig2.11.png"><img alt="_images/fig2.11.png" src="_images/fig2.11.png" style="width: 1300px; height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 12 </span><span class="caption-text">Figure 118: Figure 2.11: Parameters for edge triggering</span><a class="headerlink" href="#id101" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id102">
<span id="target-link13"></span><a class="reference internal image-reference" href="_images/fig2.12.png"><img alt="_images/fig2.12.png" src="_images/fig2.12.png" style="width: 1300px; height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 13 </span><span class="caption-text">Figure 119: Figure 2.12: Parameters for level triggering</span><a class="headerlink" href="#id102" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id103">
<span id="target-link10"></span><a class="reference internal image-reference" href="_images/fig2.13.png"><img alt="_images/fig2.13.png" src="_images/fig2.13.png" style="width: 1300px; height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 14 </span><span class="caption-text">Figure 120: Figure 2.13: Triggering in 4 channel mode at 4 samples per clock cycle.</span><a class="headerlink" href="#id103" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id104">
<span id="target-link8"></span><a class="reference internal image-reference" href="_images/fig2.14.png"><img alt="_images/fig2.14.png" src="_images/fig2.14.png" style="width: 1300px; height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 15 </span><span class="caption-text">Figure 121: Figure 2.14: Triggering in 2 channel mode at 8 samples per clock cycle.</span><a class="headerlink" href="#id104" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id105">
<span id="target-link6"></span><a class="reference internal image-reference" href="_images/fig2.15.png"><img alt="_images/fig2.15.png" src="_images/fig2.15.png" style="width: 1300px; height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 16 </span><span class="caption-text">Figure 122: Figure 2.15: Triggering in 1 channel mode at 16 samples per clock cycle.</span><a class="headerlink" href="#id105" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id106">
<span id="target-link14"></span><a class="reference internal image-reference" href="_images/fig2.16.png"><img alt="_images/fig2.16.png" src="_images/fig2.16.png" style="width: 1300px; height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 17 </span><span class="caption-text">Figure 123: Figure 2.16: From the ADC inputs, a trigger unit creates an input flag for
the trigger matrix. Each digitizer channel (A, B, C, D) has two trigger units.</span><a class="headerlink" href="#id106" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id107">
<span id="target-link4"></span><a class="reference internal image-reference" href="_images/fig2.17.png"><img alt="_images/fig2.17.png" src="_images/fig2.17.png" style="width: 1300px; height: 800px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 18 </span><span class="caption-text">Figure 124: Figure 2.17: The digital inputs Trigger, GATE,
BUS0, BUS1, BUS2 and BUS3 have simpler trigger units.</span><a class="headerlink" href="#id107" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id108">
<a class="reference internal image-reference" href="_images/fig2.18.png"><img alt="_images/fig2.18.png" src="_images/fig2.18.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 19 </span><span class="caption-text">Figure 125: Figure 2.18: The extension block combines signals from
the optional extension board and the sync cable.</span><a class="headerlink" href="#id108" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id109">
<span id="target-link15"></span><a class="reference internal image-reference" href="_images/fig2.19.png"><img alt="_images/fig2.19.png" src="_images/fig2.19.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 20 </span><span class="caption-text">Figure 126: Figure 2.19: Trigger Matrix: The trigger signals of each ADC channel, the trigger
input, the GATE input or the sync cable can be combined to create a
trigger input for each trigger block. The four gate signals can be used
to suppress triggers during certain time frames.</span><a class="headerlink" href="#id109" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id110">
<span id="target-link16"></span><a class="reference internal image-reference" href="_images/fig2.20.png"><img alt="_images/fig2.20.png" src="_images/fig2.20.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 21 </span><span class="caption-text">Figure 127: Figure 2.20: Gating Blocks: Each gating block can use an arbitrary combination
of inputs to trigger its state machine. The outputs can be individually
inverted and routed to the AND-gate feeding the trigger blocks.</span><a class="headerlink" href="#id110" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
</section>
<section id="driver-programming-api">
<h1><span class="sectnum">3</span> Driver Programming API<a class="headerlink" href="#driver-programming-api" title="Permalink to this heading"></a></h1>
<p>The API is a DLL with C linkage. The functions provided by the DLL are
declared in <strong>Ndigointerface.h.</strong></p>
<section id="constants">
<h2><span class="sectnum">3.1</span> Constants<a class="headerlink" href="#constants" title="Permalink to this heading"></a></h2>
<p><strong>#define NDIGO_CHANNEL_COUNT 4</strong></p>
<p>The number of analog input channels.</p>
<p><strong>#define NDIGO_GATE_COUNT 4</strong></p>
<p>The number of gating blocks.</p>
<p><strong>#define NDIGO_TRIGGER_COUNT 16</strong></p>
<p>The number of triggers. Two per analog input, one per digital input
plus some specials.</p>
<p><strong>#define NDIGO_ADD_TRIGGER_COUNT 6</strong></p>
<p>Additional set of triggers for digital inputs.</p>
</section>
<section id="initialization">
<h2><span class="sectnum">3.2</span> Initialization<a class="headerlink" href="#initialization" title="Permalink to this heading"></a></h2>
<p>int ndigo_count_devices(int <a href="#id3"><span class="problematic" id="id4">*</span></a>error_code, char <a href="#id5"><span class="problematic" id="id6">**</span></a>error message)</p>
<p>Return the number of boards that are supported by this driver in the system.</p>
<p>int ndigo_get_default_init_parameters(ndigo_init_parameters <a href="#id7"><span class="problematic" id="id8">*</span></a>init)</p>
<p>Get a set of default parameters to feed into <strong>ndigoinit().</strong>
This must always be used to initialize the <strong>ndigo_init_parameter</strong> structure.</p>
<p>indigo_device <a href="#id9"><span class="problematic" id="id10">*</span></a>ndigo_init(ndigo_init_parameters <a href="#id11"><span class="problematic" id="id12">*</span></a>params, int <a href="#id13"><span class="problematic" id="id14">*</span></a>error_code, char <a href="#id15"><span class="problematic" id="id16">**</span></a>error_message)</p>
<p>Open and initialize the Ndigo board with the given index. With <strong>error_code</strong> and <strong>error_message</strong>
the user must provide pointers where to buffers where error information should be written by the driver. The
buffer for the error message must by at least <strong>80 chars</strong> long.</p>
<p>Params is a structure of type <strong>ndigo_init_parameters</strong> that must be
completely initialized.</p>
<p>int ndigo_close(ndigo_device <a href="#id17"><span class="problematic" id="id18">*</span></a>device)</p>
<p>Finalize the driver for this device.</p>
<section id="structure-ndigo-init-parameters">
<h3><span class="sectnum">3.2.1</span> Structure ndigo_init_parameters<a class="headerlink" href="#structure-ndigo-init-parameters" title="Permalink to this heading"></a></h3>
<p><strong>int version</strong></p>
<p>Must be set to <strong>NDIGO_API_VERSION</strong></p>
<p><strong>int card_index</strong></p>
<p>The index in the list of <strong>Ndigo5G</strong> boards that should be initialized.
There might be multiple boards in the system that are handled by this
driver as reported by <strong>ndigo_count_devices</strong>. This index selects one of
them. Boards are enumerated depending on the PCIe slot. The lower the
bus number and the lower the slot number the lower the card index.</p>
<p>int board_id
This 8 bit number is filled into each packet created by the board and
is useful if data streams of multiple boards will be merged. If only
<strong>Ndigo5G</strong> cards are used this number can be set to the card index. If
boards of different types that use a compatible data format are used
in a system each board should get a unique id.</p>
<p>Can be changed with int ndigosetboardid(ndigodevice*device, int boardid).</p>
<p><strong>ndigo_bool_t use_external_clock</strong></p>
<p>Use 10MHz clock supplied by IPC flat band cable. Must be set for all slaves.</p>
<p><strong>ndigo_bool_t drive_external_clock</strong></p>
<p>Drive internal 10MHz clock of this board to IPC flat band cable. Must be set for master.</p>
<p><strong>ndigo_bool_t is_slave</strong></p>
<p>Data acquisition of this board is controlled by the master board.</p>
<p><strong>int sync_period</strong></p>
<p>Period of the multicard sync pulse. Should be set to <strong>4</strong> (default) when
using several Ndigo boards in sync. Ignored for single board setups.
The <strong>Ndigo5G</strong> has 4 phases relative to the global 10MHz clock.</p>
<p><strong>int sync_delay</strong></p>
<p>Fine tap delay for incoming sync signals.</p>
<p><strong>ndigo_bool_t force_window_calibration</strong></p>
<p>If <strong>true/1</strong>, valid data window is detected at initialization. Default value is <strong>false/0:</strong>
values from flash memory are used in order to set data window to correct position.</p>
<p><strong>ndigo_bool_t hptdc_sync_enabled</strong></p>
<p>A <strong>HPTDC</strong> is connected to this board. Enables the clock and sync line
from the <strong>Ndigo5G</strong> to the <strong>HPTDC</strong>.</p>
<p><strong>__int64 buffer_size[8]</strong></p>
<p>The minimum size of the DMA buffer. If set to 0 the default size of
16MByte is used. <strong>Ndigo5G</strong> only uses <strong>buffer_size[0]</strong>.</p>
<p><strong>int buffer_type</strong></p>
<p>Must be set to <strong>NDIGO_BUFFER_ALLOCATE</strong>.</p>
<p><strong>__int64 buffer_address</strong></p>
<p>Ignored. Might be used for future buffer types.</p>
<p><strong>int variant</strong></p>
<p>Set to 0. Can be used to activate future device variants such as
different base frequencies.</p>
<p><strong>int device_type</strong></p>
<p>Initialized by ndigo_get_default_init_parameters(). Must be left unchanged.</p>
<blockquote>
<div><p>#define CRONO_DEVICE_HPTDC 0</p>
<p>#define CRONO_DEVICE_NDIGO5G 1</p>
<p>#define CRONO_DEVICE_NDIGO250M 2</p>
</div></blockquote>
<p><strong>int_dma read_delay</strong></p>
<p>Initialized by <strong>ndigo_get_default_init_parameters()</strong>. The write pointer
update is delay by this number of <strong>4 ns</strong> clock periods to hide race
conditions between software and DMA.</p>
</section>
</section>
<section id="status-information">
<h2><span class="sectnum">3.3</span> Status Information<a class="headerlink" href="#status-information" title="Permalink to this heading"></a></h2>
<section id="functions-for-information-retrieval">
<h3><span class="sectnum">3.3.1</span> Functions for Information Retrieval<a class="headerlink" href="#functions-for-information-retrieval" title="Permalink to this heading"></a></h3>
<p>The driver provides functions to retrieve detailed information on the
type of board, its configuration, settings and state. The information is
split according to its scope and the computational requirements to query
the information from the board.</p>
<p>int ndigo_get_driver_revision()
Returns the driver version, same format as ndigo_static_info::driver_revision.
This function does not require a present <strong>Ndigo5G</strong> device.</p>
<p><strong>const char* ndigo_get_driver_revision_str()</strong></p>
<p>Returns the driver version including SVN build revision as a string.
This function does not require a present <strong>Ndigo5G</strong> device.</p>
<p>int ndigo_get_static_info(ndigo_device <a href="#id19"><span class="problematic" id="id20">*</span></a>device, ndigo_static_info <a href="#id21"><span class="problematic" id="id22">*</span></a>info)</p>
<p>This structure contains information about the board that does not
change during run time.</p>
<p>int ndigo_get_param_info(ndigo device <a href="#id23"><span class="problematic" id="id24">*</span></a>device, ndigo_param_info <a href="#id25"><span class="problematic" id="id26">*</span></a>info)</p>
<p>The structure returned by this call contains information that changes
indirectly due to configuration changes.</p>
<p>int ndigo_get_fast_info(ndigo device <a href="#id27"><span class="problematic" id="id28">*</span></a>device, ndigo_fast_info <a href="#id29"><span class="problematic" id="id30">*</span></a>info)</p>
<p>This call returns a structure that contains dynamic information that
can be obtained within a few microseconds.</p>
<p>int ndigo_get_slow_info(ndigo device <a href="#id31"><span class="problematic" id="id32">*</span></a>device, ndigo_slow_info <a href="#id33"><span class="problematic" id="id34">*</span></a>info)
The data reported in this structure requires milliseconds to be
obtained. The application should only call it in situation where the
program flow can cope with an interruption of that magnitude.</p>
<p>const char* ndigo_get_last_error_message(ndigo_device <a href="#id35"><span class="problematic" id="id36">*</span></a>device)</p>
</section>
</section>
<section id="structure-ndigo-static-info">
<h2><span class="sectnum">3.4</span> Structure ndigo_static_info<a class="headerlink" href="#structure-ndigo-static-info" title="Permalink to this heading"></a></h2>
<p>This structure contains information about the board that does not change
during run time. It is provided by the function  <strong>ndigo_get_static_info</strong>.</p>
<p><strong>int size</strong></p>
<p>The number of bytes occupied by the structure</p>
<p><strong>int version</strong></p>
<p>A version number that is increased when the definition of the
structure is changed. The increment can be larger than one to match
driver version numbers or similar. Set to <strong>0</strong> for all versions up to
first release.</p>
<p><strong>int board_id</strong></p>
<p>Index of the board as passed to the constructor or set via int
ndigosetboardid(ndigodevice <a href="#id37"><span class="problematic" id="id38">*</span></a>device, int boardid).</p>
<p><strong>int driver_revision</strong></p>
<p>The lower three bytes contain a triple level hierarchy of version
numbers, e.g. <strong>0x010103</strong> encodes <strong>version 1.1.3.</strong></p>
<p>A change in the first digit generally requires a recompilation of user
applications. Change in the second digit denote significant improvements
or changes that don’t break compatibility and the third digit changes
with minor bugfixes and similar updates.</p>
<p><strong>int firmware_revision</strong></p>
<p>Firmware revision of the FPGA configuration. This increments only when
there is a functional change.</p>
<p><strong>int board_revision</strong></p>
<p><strong>0</strong> for experimental prototypes labeled <strong>Rev. 1</strong></p>
<p><strong>2</strong> for the version produced until 2010 labeled <strong>Rev. 2</strong></p>
<p><strong>3</strong> for the version produced starting in 2011 labeled <strong>Rev. 3</strong></p>
<p><strong>int board_configuration</strong></p>
<p>Describes the schematic configuration of the board.</p>
<p>For <strong>board revision 0</strong> this always reads <strong>0</strong>.</p>
<p>For <strong>board revision 2</strong> the following assignments are valid:</p>
<p>If <strong>Bit 3 = 0</strong> this following is valid:</p>
<p><strong>Bit 0</strong> determines the ADC resolution. (<strong>0 = 8 - bit or 1 = 10 - bit</strong>).</p>
<dl class="simple">
<dt><strong>Bit 1</strong> determines whether the TDC-oscillator is present</dt><dd><p>(<strong>0</strong> = oscillator present, <strong>1</strong> = simple trigger).</p>
</dd>
</dl>
<p><strong>Bit 2</strong> determines the input connectors (<strong>0</strong> = single ended, <strong>1</strong> = differential).</p>
<p><strong>Bit 3 = 1</strong> signifies a special version of the board</p>
<p><strong>0xA</strong> is <strong>Ndigo1250M-12</strong> single ended with digital trigger</p>
<p><strong>0x8</strong> is <strong>Ndigo5G-8</strong> single ended with digital trigger</p>
<p><strong>For Board revision 3 the following assignments are valid:</strong></p>
<p><strong>Bit 2</strong> determines the input connectors (<strong>0</strong> = single ended, <strong>1</strong> = differential).</p>
<p>The other bits have one of the following patterns [Bits 3…0]</p>
<blockquote>
<div><p><strong>0010</strong> Ndigo5G-10 2.5u 10</p>
<p><strong>0011</strong> Ndigo5G-8-AQ 2.5u 8</p>
<p><strong>0110</strong> Ndigo5G-10-Diff 560pF 10 DIFF</p>
<p><strong>1000</strong> Ndigo5G-8 560pF 8+</p>
<p><strong>1010</strong> Ndigo1250M-12 2.2uF 12 Sciex DC</p>
<p><strong>1011</strong> Ndigo5G-10 560pF 10</p>
<p><strong>1110</strong> Ndigo5G-Sciex 2.2uF 10 Sciex Infiniband, DIFF</p>
<p><strong>1111</strong> Ndigo5G-Roent = fADC4/10 560pF 10</p>
</div></blockquote>
<p><strong>int adc_resolution</strong></p>
<p>Number of bits of the ADC, set to <strong>0</strong> if unknown.</p>
<p><strong>double nominal_sample_rate</strong></p>
<p>Sample rate in once channel mode. Usually <strong>5.0e9 = 5Gsps</strong>.</p>
<p><strong>double analog_bandwidth</strong></p>
<p><strong>3e9</strong> for <strong>3Ghz</strong>.</p>
<p><strong>int chip_id</strong></p>
<p>16 bit factory ID of the ADC chip</p>
<p><strong>int board_serial</strong>
Serial number with the year minus 2000 in the highest 8 bits of the
integer and a running number in the lower 24 bits. This number is
identical with the one on the label on the board.</p>
<p><strong>int flash_serial_low</strong></p>
<p><strong>int flash_serial_high</strong></p>
<p>64 bit manufacturer serial number of the flash chip.</p>
<p><strong>int flash_valid</strong></p>
<p>If not 0 the driver found valid calibration data in the flash on the
board and is using it.</p>
<p><strong>ndigo bool_t_dc_coupled</strong></p>
<p>Returns false for the standard AC coupled <strong>Ndigo5G</strong>.</p>
<p><strong>int subversion_revision</strong></p>
<p>A number to track builds of the firmware in more detail than the
firmware revision. It changes with every change in the firmware, even
if there is no visible effect for the user.</p>
<p><strong>char calibration_date[20]</strong></p>
<p>DIN EN ISO 8601 string YYYY-MM-DD HH:DD describing the time when the
card was calibrated.</p>
<section id="structure-ndigo-param-info">
<h3><span class="sectnum">3.4.1</span> Structure ndigo_param_info<a class="headerlink" href="#structure-ndigo-param-info" title="Permalink to this heading"></a></h3>
<p><strong>int size</strong></p>
<p>The number of bytes occupied by the structure.</p>
<p><strong>int version</strong></p>
<p>A version number that is increased when the definition of the
structure is changed. The increment can be larger than one to match
driver version numbers or similar. Set to <strong>0</strong> for all versions up to
first release.</p>
<p><strong>double bandwidth</strong></p>
<p>Analog Bandwidth setting of the ADC. Either <strong>3e9 = 3GHz or 1e9 = 1GHz</strong> for 10 bit version</p>
<p><strong>double sample_rate</strong></p>
<p>Sample rate. This <strong>is 1.25e9, 2.5e9</strong> or <strong>5.0e9</strong> depending on the current
ADC mode.
sample_rate · channels = <strong>5.0e9</strong>.</p>
<p><strong>double sample_period</strong></p>
<p>The period one sample in the data represents in picoseconds</p>
<p><strong>int board_id</strong></p>
<p>The number the board uses to identify the data source in the output
data stream.</p>
<p><strong>int channels</strong></p>
<dl class="simple">
<dt>Number of channels. 1, 2 or 4 depending on the ADC mode chosen.</dt><dd><p><strong>sample_rate · channels = 5.0e9.</strong></p>
</dd>
</dl>
<p><strong>int channel_mask</strong></p>
<p>Mask with a set bit for each enabled input channel.</p>
<p><strong>int64 total_buffer</strong></p>
<p>The total amount of the DMA buffer in bytes.</p>
</section>
<section id="structure-ndigo-fast-info">
<h3><span class="sectnum">3.4.2</span> Structure ndigo fast info<a class="headerlink" href="#structure-ndigo-fast-info" title="Permalink to this heading"></a></h3>
<p><strong>int size</strong></p>
<p>The number of bytes occupied by the structure</p>
<p><strong>int version</strong></p>
<p>A version number that is increased when the definition of the structure is changed.
The increment can be larger than one to match driver version numbers or similar.
Set to <strong>0</strong> for all versions up to first release.</p>
<p><strong>int adc_rpm</strong></p>
<p>Speed of the ADC fan. Reports <strong>0</strong> if no fan is present.</p>
<p><strong>int fpga_rpm</strong></p>
<p>Speed of the FPGA fan. Reports <strong>0</strong> if no fan is present.</p>
<p><strong>int alerts</strong></p>
<p>Alert bits from the system monitor.</p>
<p><strong>Bit 0 :</strong> FPGA temperature alert (<strong>&gt; 85°C</strong>)</p>
<p><strong>Bit 1 :</strong> Internal FPGA voltage out of range (<strong>&lt; 1:01V or &gt; 1:08V</strong> )</p>
<p><strong>Bit 2 :</strong> FPGA auxiliary voltage out of range. (<strong>&lt; 2,375V or &gt; 2,625V</strong> )</p>
<p><strong>Bit 3 :</strong> FPGA temperature critical (<strong>&gt; 125°C</strong>)</p>
<p><strong>Bit 4 :</strong> ADC temperature alert (<strong>&gt; 90°C</strong>)</p>
<p><strong>Bit 5 :</strong> ADC temperature critical (<strong>&gt; 100°C</strong>): will automatically be turned off.</p>
<p><strong>double voltage_aux</strong></p>
<p>Auxiliary FPGA voltage, nominal 2.5V</p>
<p><strong>double voltage_int</strong></p>
<p>Internal FPGA voltage, nominal 1.0V</p>
<p><strong>double fpga_temperature</strong></p>
<p>In °C measured on die.</p>
<p><strong>int pcie_link_width</strong></p>
<p>Number of PCIe lanes that the card uses. Should be 4 for <strong>Ndigo5G</strong>.</p>
<p><strong>int pcie_max_payload</strong></p>
<p>Maximum size in bytes for one PCIe transaction, depends on system configuration.</p>
</section>
<section id="structure-ndigo-slow-info">
<h3><span class="sectnum">3.4.3</span> Structure ndigo slow info<a class="headerlink" href="#structure-ndigo-slow-info" title="Permalink to this heading"></a></h3>
<p><strong>int size</strong></p>
<p>The number of bytes occupied by the structure.</p>
<p><strong>int version</strong></p>
<p>A version number that is increased when the definition of the structure is changed.
The increment can be larger than one to match driver version numbers or similar.
Set to <strong>0</strong> for all versions up to first release.</p>
<p><strong>double adc_temperature</strong></p>
<p>ADC temperature in °C measured on die.</p>
<p><strong>double board_temperature</strong></p>
<p>In °C</p>
</section>
</section>
<section id="configuration">
<h2><span class="sectnum">3.5</span> Configuration<a class="headerlink" href="#configuration" title="Permalink to this heading"></a></h2>
<p>The device is congfiured with a configuration structure. The user should first obtain a structure
that contains the default settings of the device read from an on board ROM, than modify the
structure as needed for the user application and use the result to configure the device.</p>
<p>int ndigo_get_default_configuration(ndigo_device <a href="#id39"><span class="problematic" id="id40">*</span></a>device, ndigo_configuration <a href="#id41"><span class="problematic" id="id42">*</span></a>config)</p>
<p>int ndigo_get_current_configuration(ndigo_device <a href="#id43"><span class="problematic" id="id44">*</span></a>device, ndigo_configuration <a href="#id45"><span class="problematic" id="id46">*</span></a>config)</p>
<p>int ndigo configure(ndigo_device <a href="#id47"><span class="problematic" id="id48">*</span></a>device, ndigo_configuration <a href="#id49"><span class="problematic" id="id50">*</span></a>config)</p>
<p>int ndigo_set_board_id(ndigo_device <a href="#id51"><span class="problematic" id="id52">*</span></a>device, int board_id)</p>
<p>The <strong>board_id</strong> can be changed after initialization of the card. If cronotools are
used, the <strong>board_id</strong> changes have to be done before cronotools initialization.</p>
<section id="structure-ndigo-configuration">
<h3><span class="sectnum">3.5.1</span> Structure ndigo configuration<a class="headerlink" href="#structure-ndigo-configuration" title="Permalink to this heading"></a></h3>
<p>This is the structure containing the configuration information. It is used in conjunction with
<strong>ndigo_get_default_configuration, ndigo_get_current_configuration</strong> and <strong>ndigo_configure</strong>.</p>
<p>It uses internally the structures <strong>ndigo_trigger_block</strong> and <strong>ndigo_trigger</strong>.</p>
<p><strong>int size</strong></p>
<p>The number of bytes occupied by the structure.</p>
<p><strong>int version</strong></p>
<p>A version number that is increased when the definition of the structure is changed.
The increment can be larger than one to match driver version numbers or similar.
Set to <strong>0</strong> for all versions up to first release.</p>
<p><strong>int reserved1</strong></p>
<p>Reserved for internal usage. Do not change.</p>
<p><strong>int adc mode</strong></p>
<p>Constant describing the ADC mode</p>
<blockquote>
<div><p>#define NDIGO_ADC_MODE_ABCD 0</p>
<p>#define NDIGO_ADC_MODE_AC 4</p>
<p>#define NDIGO_ADC_MODE_BC 5</p>
<p>#define NDIGO_ADC_MODE_AD 6</p>
<p>#define NDIGO_ADC_MODE_BD 7</p>
<p>#define NDIGO_ADC_MODE_A 8</p>
<p>#define NDIGO_ADC_MODE_B 9</p>
<p>#define NDIGO_ADC_MODE_C 10</p>
<p>#define NDIGO_ADC_MODE_D 11</p>
<p>#define NDIGO_ADC_MODE_AAAA 12</p>
<p>#define NDIGO_ADC_MODE_BBBB 13</p>
<p>#define NDIGO_ADC_MODE_CCCC 14</p>
<p>#define NDIGO_ADC_MODE_DDDD 15</p>
<p>#define NDIGO_ADC_MODE_A12 28 // not available on all boards</p>
<p>#define NDIGO_ADC_MODE_B12 29 // not available on all boards</p>
<p>#define NDIGO_ADC_MODE_C12 30 // not available on all boards</p>
<p>#define NDIGO_ADC_MODE_D12 31 // not available on all boards</p>
</div></blockquote>
<p><strong>double bandwidth</strong></p>
<p>Set to the minimum bandwidth required for the application.
Lower bandwidth results in reduced noise. The driver will set the ADC to the minimum
setting that has at least the desired bandwidth and report the selected bandwidth in the
<strong>ndigo_param_info</strong> structure. The -8, -10 and -12 versions currently supports <strong>1GHz</strong> and
<strong>3GHz</strong> bandwidth, the -8AQ version supports <strong>2GHz, 1.5GHz, 600MHz</strong> and <strong>500 MHz</strong>.</p>
<p><strong>ndigo_bool_t reserved</strong></p>
<p><strong>ndigo_bool_t tdc_enabled</strong></p>
<p>Enable capturing of TDC measurements on external digital input channel.</p>
<p><strong>ndigo_bool_t tdc_fb_enabled</strong></p>
<p>Enable enhanced TDC resolution. Currently not implemented.</p>
<p><strong>double analog offset[NDIGO CHANNEL COUNT]</strong></p>
<p>Sets the input DC offset-values to <strong>+- this value in volts</strong>. Defaults to <strong>0</strong>.</p>
<p><strong>double dc offset[2]</strong></p>
<p>Sets the DC offset in volts for the TDC trigger input (index 1) and the GATE input (index 0).
The trigger threshold is zero. For <strong>negative 0.8V NIM</strong> pulses a value of <strong>0.4</strong> should be set here.</p>
<p><strong>ndigo trigger trigger[NDIGO TRIGGER COUNT + NDIGO ADD TRIGGER COUNT]</strong></p>
<p>Configuration of the external trigger sources. Threshold is ignored for entries <strong>8 and above</strong>.</p>
<p>The trigger indexes refer to the entry in the trigger array and are defined like this:</p>
<blockquote>
<div><p>#define NDIGO_TRIGGER_A0 0</p>
<p>#define NDIGO_TRIGGER_A1 1</p>
<p>#define NDIGO_TRIGGER_B0 2</p>
<p>#define NDIGO_TRIGGER_B1 3</p>
<p>#define NDIGO_TRIGGER_C0 4</p>
<p>#define NDIGO_TRIGGER_C1 5</p>
<p>#define NDIGO_TRIGGER_D0 6</p>
<p>#define NDIGO_TRIGGER_1 7</p>
<p>#define NDIGO_TRIGGER_TDC 8</p>
<p>#define NDIGO_TRIGGER_GATE 9</p>
<p>#define NDIGO_TRIGGER_BUS0 10</p>
<p>#define NDIGO_TRIGGER_BUS1 11</p>
<p>#define NDIGO_TRIGGER_BUS2 12</p>
<p>#define NDIGO_TRIGGER_BUS3 13</p>
<p>#define NDIGO_TRIGGER_UTO 14</p>
<p>#define NDIGO_TRIGGER_ONE 15</p>
</div></blockquote>
<p>Always positive edge-sensitive sources:</p>
<blockquote>
<div><p>#define NDIGO_TRIGGER_TDC PE 16</p>
<p>#define NDIGO_TRIGGER_GATE PE 17</p>
<p>#define NDIGO_TRIGGER_BUS0 PE 18</p>
<p>#define NDIGO_TRIGGER_BUS1 PE 19</p>
<p>#define NDIGO_TRIGGER_BUS2 PE 20</p>
<p>#define NDIGO_TRIGGER_BUS3 PE 21</p>
</div></blockquote>
<p><strong>ndigo_trigger_block trigger_block[NDIGO_CHANNEL_COUNT + 1]</strong></p>
<p>A structure describing the trigger settings of the four channels plus
the timestamp channel. In some modes not all channels are used.</p>
<p><strong>ndigo_gating_block gating_block[4]</strong></p>
<p>A structure describing the gating blocks that can be used by the trigger blocks to filter triggers.</p>
<p><strong>ndigo_extension_block extension_block[NDIGO EXTENSION_COUNT]</strong></p>
<p>A structure describing the routing of the 4 digital channels
of the <strong>Ndigo extension board</strong> to the trigger matrix.</p>
<p><strong>int drive_bus[4]</strong></p>
<p>Enable output drive for each of the four external sync lines.
Each integer represents a bitmask selecting the trigger sources for that line.
The bit mapping is described in section Structure_ndigo_trigger_block on page 36.</p>
<p><strong>int auto_trigger_period</strong></p>
<p><strong>int auto_trigger_random_exponent</strong></p>
<p>Create a trigger either periodically or randomly. There are two parameters
<strong>M =</strong> trigger_period and <strong>N =</strong> random_exponent that result in a distance between triggers of</p>
<div class="math notranslate nohighlight">
\[T = 1 + M + [1...2^N]\]</div>
<p>clock cycles.</p>
<p><span class="math notranslate nohighlight">\(0 \leq M &lt; 2^{32}\)</span></p>
<p><span class="math notranslate nohighlight">\(0 \leq N &lt; 32\)</span></p>
<p>There is no enable or reset as the usage of this trigger can be configured in the trigger block
channel source field.</p>
<p><strong>int output_mode</strong></p>
<p>Defines the data representation in the output. <strong>Signed16</strong> scales and INL-corrects the input.
<strong>RAW</strong> directly presents the ADC values.</p>
<blockquote>
<div><p>#define NDIGO_OUTPUT_MODE_SIGNED16 0</p>
<p>#define NDIGO_OUTPUT_MODE_RAW 1</p>
<p>#define NDIGO_OUTPUT_MODE_CUSTOM 2</p>
<p>#define NDIGO_OUTPUT_MODE_CUSTOM_INL 3</p>
</div></blockquote>
<p><strong>lut_func custom _lut</strong></p>
<p>Lookup table. If the output_mode is set to <strong>NDIGO_OUTPUT_MODE_CUSTOM</strong> or
to <strong>NDIGO_OUTPUT_MODE_CUSTOM_INL</strong>, this function is used for mapping
from ADC value to output value. The driver will call this function with a value
from <strong>-1</strong> to <strong>+1</strong> and the function must return the corresponding signed 16 bit value
that the board should return for an input voltage relative to the full scale range.</p>
<p>typedef short (<a href="#id53"><span class="problematic" id="id54">*</span></a>lut func)(int channel, float x)</p>
<p>This can be used e.g. for custom INL, offset and gain correction that covers user front end
electronics. It can also invert the signal or correct the effect of logarithmic input amplifiers etc.</p>
<p>The LUT is applied on the board, thus using it does not cause any additional CPU load.
In the mode <strong>NDIGO_OUTPUT_MODE_CUSTOM_INL</strong> the on-board INL correction table is
applied before the user function, while <strong>NDIGO_OUTPUT_MODE_CUSTOM</strong> does not perform
INL correction. In order to use the user lookup table functionality, <strong>lut_func</strong> must be set to a
pointer to the LUT-function</p>
</section>
<section id="structure-ndigo-trigger">
<h3><span class="sectnum">3.5.2</span> Structure ndigo trigger<a class="headerlink" href="#structure-ndigo-trigger" title="Permalink to this heading"></a></h3>
<p><strong>short threshold</strong></p>
<p>Sets the threshold for the trigger block within the range of the ADC data of -32768 and +32768.</p>
<p>For trigger indices <strong>NDIGO_TRIGGER_TDC</strong> to <strong>NDIGO_TRIGGER_BUS3_PE</strong> the threshold is ignored.</p>
<p><strong>ndigo_bool_t edge</strong></p>
<p>If set this trigger implements edge trigger functionality else this is a level trigger.</p>
<p>For trigger indices <strong>NDIGO_TRIGGER_AUTO</strong> and <strong>NDIGO_TRIGGER_ONE</strong> this is ignored.</p>
<p>For trigger indices <strong>NDIGO_TRIGGER_TDC_PE</strong> to <strong>NDIGO_TRIGGER_BUS3_PE</strong> this must be set.</p>
<p><strong>ndigo_bool_t rising</strong></p>
<p>If set trigger on rising edges or when above threshold.</p>
<p>For trigger indices <strong>NDIGO_TRIGGER_AUTO</strong> and <strong>NDIGO_TRIGGER_ONE</strong> this is ignored.</p>
<p>For trigger indices <strong>NDIGO_TRIGGER_TDC_PE</strong> to <strong>NDIGO_TRIGGER_BUS3_PE</strong> this must be set.</p>
<p><strong>ndigo_bool_t rising</strong></p>
<p>If set trigger on rising edges or when above threshold.</p>
<p>For trigger indices <strong>NDIGO_TRIGGER_AUTO</strong> and <strong>NDIGO_TRIGGER_ONE</strong> this is ignored.</p>
<p>For trigger indices <strong>NDIGO_TRIGGER_TDC_PE</strong> to <strong>NDIGO_TRIGGER_BUS3_PE</strong> this must be set.</p>
</section>
<section id="structure-ndigo-trigger-block">
<h3><span class="sectnum">3.5.3</span> Structure ndigo_trigger_block<a class="headerlink" href="#structure-ndigo-trigger-block" title="Permalink to this heading"></a></h3>
<p><strong>ndigo_bool_t enabled</strong></p>
<p>Activate triggers on this channel.</p>
<p><strong>ndigo_bool_t retrigger</strong></p>
<p>If a new trigger condition occurs while the postcursor is acquired, the packet is extended by
starting a new postcursor. Otherwise the new trigger is ignored and the packet ends after the
precursor of the first trigger.</p>
<p>The retrigger setting is ignored for the timestamp channel.</p>
<p><strong>ndigo_bool_t reserved1</strong></p>
<p>Defaults to false. Do not change.</p>
<p><strong>ndigo_bool_t reserved2</strong></p>
<p>Defaults to false. Do not change.</p>
<p><strong>int precursor</strong></p>
<p>Precursor in multiples of 3.2ns. The amount of data preceding a trigger that is captured.
The precursor setting is ignored for the timestamp channel.</p>
<p><strong>int length</strong></p>
<p>In multiples of 3.2ns.</p>
<p>The total amount of data that is recorded in addition to the trigger window. Precursor
determines how many of these are ahead of the trigger and how many are appended
after the trigger. In <strong>edge trigger mode</strong> the trigger window always is <strong>3.2ns</strong> wide, in
<strong>level trigger mode</strong> it is as long as the trigger condition is fulfilled.</p>
<p>The length setting is ignored for the timestamp channel.</p>
<p><strong>int sources</strong></p>
<p>A bit mask with a bit set for all trigger sources that can trigger this channel.</p>
<blockquote>
<div><p>#define NDIGO_TRIGGER_SOURCE_A0 0x00000001</p>
<p>#define NDIGO_TRIGGER_SOURCE_A1 0x00000002</p>
<p>#define NDIGO_TRIGGER_SOURCE_B0 0x00000004</p>
<p>#define NDIGO_TRIGGER_SOURCE_B1 0x00000008</p>
<p>#define NDIGO_TRIGGER_SOURCE_C0 0x00000010</p>
<p>#define NDIGO_TRIGGER_SOURCE_C1 0x00000020</p>
<p>#define NDIGO_TRIGGER_SOURCE_D0 0x00000040</p>
<p>#define NDIGO_TRIGGER_SOURCE_D1 0x00000080</p>
<p>#define NDIGO_TRIGGER_SOURCE_TDC 0x00000100</p>
<p>#define NDIGO_TRIGGER_SOURCE_GATE 0x00000200</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS0 0x00000400</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS1 0x00000800</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS2 0x00001000</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS3 0x00002000</p>
<p>#define NDIGO_TRIGGER_SOURCE_AUTO 0x00004000</p>
<p>#define NDIGO_TRIGGER_SOURCE_ONE 0x00008000</p>
<p>#define NDIGO_TRIGGER_SOURCE_TDC PE 0x01000000</p>
<p>#define NDIGO_TRIGGER_SOURCE_GATE PE 0x02000000</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS0 PE 0x04000000</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS1 PE 0x08000000</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS2 PE 0x10000000</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS3 PE 0x20000000</p>
</div></blockquote>
<p><strong>int gates</strong></p>
<blockquote>
<div><p>#define_NDIGO_TRIGGER_GATE_NONE 0x0000</p>
<p>#define_NDIGO_TRIGGER_GATE_0 0x0001</p>
<p>#define_NDIGO_TRIGGER_GATE_1 0x0002</p>
<p>#define_NDIGO_TRIGGER_GATE_2 0x0004</p>
<p>#define_NDIGO_TRIGGER_GATE_3 0x0008</p>
</div></blockquote>
<p><strong>double minimum_free_packets;</strong></p>
<p>This parameter sets how many packets are supposed to t into the on-board FIFO
before a new packet is recorded after the FIFO was full, i.e. a certain amount of free
space in the FIFO is demanded before a new packet is written after the FIFO was full.</p>
<p>As a measure for the packet length the gate length set by the user is used.
The on-board algorithm checks the free FIFO space only in case the FIFO is full.
Therefore, if this number is <strong>1.0</strong> or more, at least every second packet in the DMA
buffer is guaranteed to have the full length set by the gate length parameters.
In many cases smaller values will also result in full length packets. But below
a certain value multiple packets that are cut off at the end will show up.</p>
</section>
<section id="structure-ndigo-gating-block">
<h3><span class="sectnum">3.5.4</span> Structure ndigo gating block<a class="headerlink" href="#structure-ndigo-gating-block" title="Permalink to this heading"></a></h3>
<p><strong>ndigo_bool_t negate</strong></p>
<p>Invert output polarity. Defaults to false.</p>
<p><strong>ndigo_bool_t retrigger</strong></p>
<p>Defaults to false. If retriggering is enabled, the timer is reset to the value of the start parameter
whenever the input signal is set while waiting to reach the stop time.</p>
<p><strong>ndigo_bool_t extend</strong></p>
<p>Defaults to true. If set, a gate is created with the set timing from the first occurrence of the
input trigger even for short gates. If not set, the input signal must persist for the gate to be
created. This feature is <strong>NOT YET IMPLEMENTED.</strong></p>
<p><strong>ndigo_bool_t reserved1</strong></p>
<p>Defaults to false. Do not change.</p>
<p><strong>int start</strong></p>
<p>In multiples of <strong>3.2ns</strong>. The time from the first input signal seen in the idle state until the gating
output is set. The value of start needs to be less or equal to the stop value. Maximum value for
start and stop is <span class="math notranslate nohighlight">\(2^{16}-1\)</span>.</p>
<p><strong>int stop</strong></p>
<p>In multiples of <strong>3.2ns</strong>. Maximum allowed value is <span class="math notranslate nohighlight">\(2^{16}-1\)</span>.</p>
<p>The time from leaving the idle state until the gating output is reset. If retriggering is enabled,
the timer is reset to the value of the start parameter whenever the input signal is set while
waiting to reach the stop time.</p>
<p><strong>int sources</strong></p>
<p>A bit mask with a bit set for all trigger sources that can trigger this channel. The gates cannot
use the additional digital trigger sources <strong>NDIGO_TRIGGER_SOURCE_TDC_PE</strong> to
<strong>NDIGO_TRIGGER_SOURCE_BUS3_PE</strong>.</p>
<blockquote>
<div><p>#define NDIGO_TRIGGER_SOURCE_A0 0x00000001</p>
<p>#define NDIGO_TRIGGER_SOURCE_A1 0x00000002</p>
<p>#define NDIGO_TRIGGER_SOURCE_B0 0x00000004</p>
<p>#define NDIGO_TRIGGER_SOURCE_B1 0x00000008</p>
<p>#define NDIGO_TRIGGER_SOURCE_C0 0x00000010</p>
<p>#define NDIGO_TRIGGER_SOURCE_C1 0x00000020</p>
<p>#define NDIGO_TRIGGER_SOURCE_D0 0x00000040</p>
<p>#define NDIGO_TRIGGER_SOURCE_D1 0x00000080</p>
<p>#define NDIGO_TRIGGER_SOURCE_TDC 0x00000100</p>
<p>#define NDIGO_TRIGGER_SOURCE_GATE 0x00000200</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS0 0x00000400</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS1 0x00000800</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS2 0x00001000</p>
<p>#define NDIGO_TRIGGER_SOURCE_BUS3 0x00002000</p>
<p>#define NDIGO_TRIGGER_SOURCE_AUTO 0x00004000</p>
<p>#define NDIGO_TRIGGER_SOURCE_ONE 0x00008000</p>
</div></blockquote>
</section>
<section id="structure-ndigo-extension-block">
<h3><span class="sectnum">3.5.5</span> Structure ndigo extension block<a class="headerlink" href="#structure-ndigo-extension-block" title="Permalink to this heading"></a></h3>
<p>This structure configures how the inputs from the optional extension board and signals from
the synchronization bus are merged.</p>
<p><strong>ndigo_bool_t enable</strong></p>
<p>Enable routing of digital signal from Ndigo extension board to the according <strong>BUSx</strong> trigger unit.</p>
<p><strong>ndigo_bool_t ignore_cable</strong></p>
<p>If <strong>false</strong> input signal and BUS signal are <a href="#id55"><span class="problematic" id="id56">**</span></a>OR**ed before routing to the according</p>
<p><strong>BUSx</strong> trigger unit. Otherwise only the signal from <strong>Ndigo extension board</strong> is used.</p>
</section>
<section id="run-time-control">
<h3><span class="sectnum">3.5.6</span> Run Time Control<a class="headerlink" href="#run-time-control" title="Permalink to this heading"></a></h3>
<p>int ndigo_start_capture(ndigo_device <a href="#id57"><span class="problematic" id="id58">*</span></a>device)</p>
<p>int ndigo_pause_capture(ndigo_device <a href="#id59"><span class="problematic" id="id60">*</span></a>device)</p>
<p>int ndigo_continue_capture(ndigo_device <a href="#id61"><span class="problematic" id="id62">*</span></a>device)</p>
<p>Call this to resume data acquisition after a call to ndigo_pause_capture.</p>
<p>int ndigo_stop_capture(ndigo_device <a href="#id63"><span class="problematic" id="id64">*</span></a>device)</p>
</section>
</section>
<section id="readout">
<h2><span class="sectnum">3.6</span> Readout<a class="headerlink" href="#readout" title="Permalink to this heading"></a></h2>
<p>int ndigo_read(ndigo_device <a href="#id65"><span class="problematic" id="id66">*</span></a>device, ndigo_read in <a href="#id67"><span class="problematic" id="id68">*</span></a>in, ndigo_read_out <a href="#id69"><span class="problematic" id="id70">*</span></a>out)</p>
<p>Return a pointer to an array of captured data in <strong>read_out</strong>. The result can contain any number
of packets of type <strong>ndigo_packet. read_in</strong> provides parameters to the driver. A call to this
method automatically allows the driver to reuse the memory returned in the previous call.</p>
<p>Returns an error code as defined in the structure <strong>ndigo_read_out</strong>.</p>
<p>int ndigo_acknowledge(ndigo_device <a href="#id71"><span class="problematic" id="id72">*</span></a>device, ndigo_packet <a href="#id73"><span class="problematic" id="id74">*</span></a>packet)</p>
<p>Acknowledge all data up to the packet provided as parameter. This is mandatory if
<strong>acknowledge_last_read</strong> in the <strong>ndigo_read_in</strong> structure is set to <strong>false</strong> for calls to <strong>ndigo_read</strong>.</p>
<p>This feature allows to either free up partial DMA space early if there will be no call to
<strong>ndigo_read</strong> anytime soon. It also allows to keep data over multiple calls to <strong>ndigo_read</strong> to avoid
unnecessary copying of data.</p>
<p>int ndigo_process_tdc_packet(ndigo_device <a href="#id75"><span class="problematic" id="id76">*</span></a>device, ndigo_packet <a href="#id77"><span class="problematic" id="id78">*</span></a>packet)</p>
<p>Call on a TDC packet to update the timestamp of the packet with a more accurate value.
If called more than once on a packet the timestamp will be invalid.</p>
<section id="input-structure-ndigo-read-in">
<h3><span class="sectnum">3.6.1</span> Input Structure ndigo read in<a class="headerlink" href="#input-structure-ndigo-read-in" title="Permalink to this heading"></a></h3>
<p><strong>ndigo_bool_t acknowledge_last_read</strong></p>
<p>If set <strong>ndigo_read</strong> automatically acknowledges packets from the last read.</p>
</section>
<section id="input-structure-ndigo-read-out">
<h3><span class="sectnum">3.6.2</span> Input Structure ndigo read out<a class="headerlink" href="#input-structure-ndigo-read-out" title="Permalink to this heading"></a></h3>
<p>ndigo_packet <a href="#id79"><span class="problematic" id="id80">*</span></a>first_packet</p>
<p>Pointer to the first packet that was capture by the call of ndigo_read.</p>
<p>ndigo_packet <a href="#id81"><span class="problematic" id="id82">*</span></a>last_packet</p>
<p>Address of header of the last packet in the buffer.</p>
<p><strong>int error_code</strong></p>
<p>#define NDIGO_READ_OK 0</p>
<p>#define NDIGO_READ_NO_DATA 1</p>
<p>#define NDIGO_READ_INTERNAL_ERROR 2</p>
<p>const char <a href="#id83"><span class="problematic" id="id84">*</span></a>error_message</p>
</section>
</section>
<section id="other-functions">
<h2><span class="sectnum">3.7</span> Other Functions<a class="headerlink" href="#other-functions" title="Permalink to this heading"></a></h2>
<section id="led-control">
<h3><span class="sectnum">3.7.1</span> LED control<a class="headerlink" href="#led-control" title="Permalink to this heading"></a></h3>
<p>There are six LEDs on the front panel. The intensity of the red and green part can be set from
<strong>0</strong> to <strong>255</strong>. There is no blue component in the current version. Per default all LEDs are set to
<strong>auto mode</strong>. This means that used channels are lit <strong>green</strong>, activity is shown as <strong>yellow</strong> on
overflow is shown as <strong>red</strong>.</p>
<p>int ndigo_set_led_color(ndigo device <a href="#id85"><span class="problematic" id="id86">*</span></a>device, int led, unsigned short r, unsigned short g,
unsigned short b)</p>
<p>Set the LED to the selected color. No automatic updates are performed.</p>
<p>int ndigo set led automode(ndigo device <a href="#id87"><span class="problematic" id="id88">*</span></a>device, int led)</p>
<p>Let the selected LED be controlled by hardware.</p>
</section>
</section>
</section>
<section id="packet-format">
<h1><span class="sectnum">4</span> Packet Format<a class="headerlink" href="#packet-format" title="Permalink to this heading"></a></h1>
<section id="output-structure-ndigopacket">
<h2><span class="sectnum">4.1</span> Output Structure ndigopacket<a class="headerlink" href="#output-structure-ndigopacket" title="Permalink to this heading"></a></h2>
<p><strong>unsigned char channel</strong></p>
<p><strong>0</strong> to <strong>3</strong> for the ADC input channels, <strong>4</strong> for the TDC, <strong>5</strong> for the timestamp channel.</p>
<p><strong>unsigned char card</strong></p>
<p>Identifies the source card in case there are multiple boards present.
Defaults to <strong>0</strong> if no value is assigned to the parameter boardid in Structure
ndigoinitparameters or set via</p>
<blockquote>
<div><p><strong>int ndigosetboardid(ndigodevice *device, int boardid).</strong></p>
</div></blockquote>
<p><strong>unsigned char type</strong></p>
<p>For the ADC channels this is set to <strong>1</strong> to signify <strong>16 bit signed</strong> data.</p>
<p>For the TDC channel it is set to <strong>8</strong> to signify <strong>64 bit unsigned</strong> data.</p>
<p>If the type field is 128 or greater then there is no data present, even
if length is not <strong>0</strong>. In this cases the length field may contain other
data.</p>
<div class="small docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 9%" />
<col style="width: 45%" />
<col style="width: 45%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Length Field</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Number of payload words</p></td>
<td><p>16 bit signed samples from
one of the ADCs</p></td>
</tr>
<tr class="row-odd"><td><p>8</p></td>
<td><p>Number of payload words</p></td>
<td><p>64 Bit unsigned TDC Data,
only for internal processing</p></td>
</tr>
<tr class="row-even"><td><p>128</p></td>
<td><p>Bit pattern of trigger
sources</p></td>
<td><p>Whenever at least one of the
sources that is enabled for
the timestamp channel
triggers, one of these
packets is generated. The
length field contains the
triggers active when this
packet was created.</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>unsigned char flags</strong></p>
<blockquote>
<div><p>#define NDIGO_PACKET_FLAG_SHORTENED 1</p>
</div></blockquote>
<p>If the bit with <strong>weight 1</strong> is set, the packet was truncated because the internal
FIFO was full. Less than the requested number of samples have
been written due to the full FIFO.</p>
<blockquote>
<div><p>#define NDIGO_PACKET_FLAG_PACKETS LOST 2</p>
</div></blockquote>
<p>If the bit with <strong>weight 2</strong> is set, there are lost triggers immediatel
preceding this packet due to insufficient DMA buffers. The DMA
controller has discarded packets due to full host buffer.</p>
<blockquote>
<div><p>#define NDIGO_PACKET_FLAG_OVERFLOW 4</p>
</div></blockquote>
<p>If the bit with <strong>weight 4</strong> is set, the packet contains ADC sample overflows.</p>
<blockquote>
<div><p>#define NDIGO_PACKET_FLAG_TRIGGER MISSED 8</p>
</div></blockquote>
<p>If the bit with <strong>weight 8</strong> is set, there are lost triggers immediately
preceding this packet due to insufficient buffers. The trigger unit
has discarded packets due to full FIFO.</p>
<blockquote>
<div><p>#define NDIGO_PACKET_FLAG_DMA FIFO FULL 16</p>
</div></blockquote>
<p>If the bit with <strong>weight 16</strong> is set, the internal DMA FIFO was full.
Triggers only got lost if a subsequent package has the bit with <strong>weight
8</strong> set.</p>
<blockquote>
<div><p>#define NDIGO_PACKET_FLAG_HOST_BUFFER_FULL 32</p>
</div></blockquote>
<p>If the bit with <strong>weight 32</strong> is set, the host buffer was full. Triggers
only got lost if a subsequent package has the bit with <strong>weight 8</strong> set.</p>
<blockquote>
<div><p>#define NDIGO_PACKET_FLAG_TDC_NO_EDGE 64</p>
</div></blockquote>
<p>If the bit with <strong>weight 64</strong> is set, the packet from the TDC does not
contain valid data and the timestamp is not corrected. No valid edge
was found in TDC packet.</p>
<p><strong>unsigned int length</strong></p>
<p>Number of <strong>64-bit</strong> elements (each containing 4 samples) in the data
array if type <span class="math notranslate nohighlight">\(&lt; 128\)</span>.</p>
<p>If <strong>type = 128</strong> this is the pattern of trigger sources that where active
in the clock cycle given by the timestamp. Bits are set according to the
trigger sources, i.e. <strong>bit 0</strong> is set if <strong>trigger A0</strong> was active, <strong>bit 29</strong> is
set if <strong>trigger BUS3 PE</strong> was active. Use the <strong>NDIGO_TRIGGER_SOURCE_*</strong> to
check for the bits set.</p>
<p><strong>unsigned __int64 timestamp</strong></p>
<p>ADC channels <strong>A</strong> to <strong>D</strong>: Timestamp of the last word in the packet in ps.</p>
<p>TDC: Timestamp of the trigger event (falling edge) on the TDC channel in
ps. When <strong>ndigo_process_tdc_packet()</strong> is called once on the packet the
timestamp is replaced with the precise timestamp for the edge.</p>
<p>Timestamp channel: Timestamp of the trigger event in ps.</p>
<p><strong>unsigned __int64 data[]</strong></p>
<p>Sample data. For the <strong>Ndigo5G</strong> each <strong>64 bit</strong> word contains four <strong>16 bit</strong>
signed words from the ADC. The user can cast the array to short* to
directly operate on the sample data.</p>
</section>
</section>
<section id="c-example">
<h1><span class="sectnum">5</span> C-Example<a class="headerlink" href="#c-example" title="Permalink to this heading"></a></h1>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;Ndigo_interface.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span><span class="w"></span>
<span class="w">   </span><span class="n">ndigo_init_parameters</span><span class="w"> </span><span class="n">params</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">ndigo_get_default_init_parameters</span><span class="p">(</span><span class="o">&amp;</span><span class="n">params</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="n">params</span><span class="p">.</span><span class="n">card_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">params</span><span class="p">.</span><span class="n">buffer_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">23</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">params</span><span class="p">.</span><span class="n">drive_external_clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">params</span><span class="p">.</span><span class="n">is_slave</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">params</span><span class="p">.</span><span class="n">use_external_clock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">error_code</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="n">error_message</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">ndigo_device</span><span class="o">*</span><span class="w"> </span><span class="n">ndgo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndigo_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">params</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error_code</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error_message</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">error_code</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NDIGO_OK</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Error %d: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">error_code</span><span class="p">,</span><span class="w"> </span><span class="n">error_message</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="n">ndigo_configuration</span><span class="w"> </span><span class="n">config</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">ndigo_get_default_configuration</span><span class="p">(</span><span class="n">ndgo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">adc_mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NDIGO_ADC_MODE_ABCD</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// disable unused trigger blocks</span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="c1">// configure trigger block 0</span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">minimum_free_packets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">precursor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">retrigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">sources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NDIGO_TRIGGER_SOURCE_A0</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">16</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">gates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">NDIGO_TRIGGER_GATE_NONE</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">analog_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.1</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger</span><span class="p">[</span><span class="n">NDIGO_TRIGGER_A0</span><span class="p">].</span><span class="n">edge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger</span><span class="p">[</span><span class="n">NDIGO_TRIGGER_A0</span><span class="p">].</span><span class="n">rising</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">config</span><span class="p">.</span><span class="n">trigger</span><span class="p">[</span><span class="n">NDIGO_TRIGGER_A0</span><span class="p">].</span><span class="n">threshold</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ndigo_configure</span><span class="p">(</span><span class="n">ndgo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">config</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">NDIGO_OK</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Fatal configuration error. Aborting...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="n">exit</span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>

<span class="w">   </span><span class="n">ndigo_start_capture</span><span class="p">(</span><span class="n">ndgo</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="c1">// counts the number of packets received</span>
<span class="w">   </span><span class="kt">int</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="w">   </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">count</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">       </span><span class="n">ndigo_read_in</span><span class="w"> </span><span class="n">in</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="c1">// Do not wait for data</span>
<span class="w">       </span><span class="c1">// (if set to 1 the ndigo_acknowledge function has to be removed)</span>
<span class="w">       </span><span class="n">in</span><span class="p">.</span><span class="n">acknowledge_last_read</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="n">ndigo_read_out</span><span class="w"> </span><span class="n">out</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="kt">int</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndigo_read</span><span class="p">(</span><span class="n">ndgo</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">out</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="n">result</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">           </span><span class="c1">// buffer received with one or more packets</span>
<span class="w">           </span><span class="n">ndigo_packet</span><span class="w"> </span><span class="o">*</span><span class="n">packet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">first_packet</span><span class="p">;</span><span class="w"></span>
<span class="w">           </span><span class="k">while</span><span class="p">(</span><span class="w"> </span><span class="n">packet</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">out</span><span class="p">.</span><span class="n">last_packet</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">               </span><span class="kt">int</span><span class="w"> </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">               </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">type</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NDIGO_PACKET_TYPE_TIMESTAMP_ONLY</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">                   </span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">;</span><span class="w"></span>

<span class="w">               </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;Card %02x, Channel %02x, Flags %02x, Length %6d, Timestamp %llu </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span><span class="w"> </span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">channel</span><span class="p">,</span><span class="w"> </span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">,</span><span class="w"> </span><span class="n">length</span><span class="p">,</span><span class="w"> </span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">timestamp</span><span class="p">);</span><span class="w"></span>
<span class="w">               </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">type</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">NDIGO_PACKET_TYPE_TIMESTAMP_ONLY</span><span class="p">)</span><span class="w"> </span><span class="p">){</span><span class="w"></span>
<span class="w">                   </span><span class="kt">short</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">short</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span><span class="w"></span>
<span class="w">                   </span><span class="k">for</span><span class="p">(</span><span class="w"> </span><span class="n">inti</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">packet</span><span class="o">-&gt;</span><span class="n">length</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">                       </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;%6d, &quot;</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="p">(</span><span class="n">data</span><span class="o">++</span><span class="p">));</span><span class="w"></span>
<span class="w">                   </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span><span class="w"></span>
<span class="w">               </span><span class="p">}</span><span class="w"></span>
<span class="w">               </span><span class="c1">// current packet pointer is invalid after call to ndigo_acknowledge</span>
<span class="w">               </span><span class="n">ndigo_packet</span><span class="w"> </span><span class="o">*</span><span class="n">next_packet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndigo_next_packet</span><span class="p">(</span><span class="n">packet</span><span class="p">);</span><span class="w"></span>
<span class="w">               </span><span class="n">ndigo_acknowledge</span><span class="p">(</span><span class="n">ndgo</span><span class="p">,</span><span class="w"> </span><span class="n">packet</span><span class="p">);</span><span class="w"></span>
<span class="w">               </span><span class="n">packet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_packet</span><span class="p">;</span><span class="w"></span>
<span class="w">               </span><span class="n">count</span><span class="o">++</span><span class="p">;</span><span class="w"></span>
<span class="w">           </span><span class="p">}</span><span class="w"></span>
<span class="w">       </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="p">}</span><span class="w"></span>
<span class="w">   </span><span class="n">ndigo_close</span><span class="p">(</span><span class="n">ndgo</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">return0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="technical-data">
<h1><span class="sectnum">6</span> Technical Data<a class="headerlink" href="#technical-data" title="Permalink to this heading"></a></h1>
<ul class="simple">
<li><p>Input Passband: <strong>4.5MHz</strong> to <strong>950MHz.</strong></p></li>
<li><p>Power Requirements: <strong>25W</strong></p></li>
<li><p>Mechanical Dimensions: <strong>170mm</strong> <span class="math notranslate nohighlight">\(\times\)</span> <strong>106mm</strong></p></li>
<li><p>Throughput: <strong>800MByte/s</strong> on PCIe x4</p></li>
</ul>
<section id="digitizer-characteristics">
<h2><span class="sectnum">6.1</span> Digitizer Characteristics<a class="headerlink" href="#digitizer-characteristics" title="Permalink to this heading"></a></h2>
<p>Each board is tested against the values listed in the <strong>Min</strong> column.
‘‘Typical’’ is the mean value of the first 10 boards produced.</p>
<section id="channel-mode-5gsps">
<h3><span class="sectnum">6.1.1</span> 1-Channel-Mode (5Gsps)<a class="headerlink" href="#channel-mode-5gsps" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 32%" />
<col style="width: 34%" />
<col style="width: 7%" />
<col style="width: 12%" />
<col style="width: 7%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Typical</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>THD1</p></td>
<td><p>Total Harmonic
Distortion</p></td>
<td><p>56</p></td>
<td><p>60</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-odd"><td><p>SNR1</p></td>
<td><p>Signal to Noise Ration</p></td>
<td><p>47</p></td>
<td><p>49</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\({SFDR}\)</span> incl 1</p></td>
<td><p>Spurious Free Dynamic
Range (including
Harmonics)</p></td>
<td><p>55</p></td>
<td><p>59</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-odd"><td><p>SFDR1</p></td>
<td><p>Spurious Free Dynamic
Range (excluding
Harmonics)</p></td>
<td><p>55</p></td>
<td><p>60</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-even"><td><p>SINAD1</p></td>
<td><p>Signal-to-Interference
Ratio including Noise
and Distortion</p></td>
<td><p>47</p></td>
<td><p>48</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-odd"><td><p>ENOB1</p></td>
<td><p>Effective Number of Bits</p></td>
<td><p>7,5</p></td>
<td><p>7,7</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="channel-mode-2-5-gsps">
<h3><span class="sectnum">6.1.2</span> 2-Channel-Mode (2.5 Gsps)<a class="headerlink" href="#channel-mode-2-5-gsps" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 43%" />
<col style="width: 8%" />
<col style="width: 15%" />
<col style="width: 8%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Typical</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>THD2</p></td>
<td><p>Total Harmonic
Distortion</p></td>
<td><p>56</p></td>
<td><p>60</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-odd"><td><p>SNR2</p></td>
<td><p>Signal to Noise Ration</p></td>
<td><p>49</p></td>
<td><p>51</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-even"><td><p>SFDR2</p></td>
<td><p>Spurious Free Dynamic
Range (including
Harmonics)</p></td>
<td><p>58</p></td>
<td><p>60</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-odd"><td><p>SFDR2</p></td>
<td><p>Spurious Free Dynamic
Range (excluding
Harmonics)</p></td>
<td><p>58</p></td>
<td><p>61</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-even"><td><p>SINAD2</p></td>
<td><p>Signal-to-Interference
Ratio including Noise
and Distortion</p></td>
<td><p>49</p></td>
<td><p>50</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-odd"><td><p>ENOB2</p></td>
<td><p>Effective Number of Bits</p></td>
<td><p>7,8</p></td>
<td><p>8,1</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
<section id="channel-mode-1-25-gsps">
<h3><span class="sectnum">6.1.3</span> 4-Channel-Mode (1.25 Gsps)<a class="headerlink" href="#channel-mode-1-25-gsps" title="Permalink to this heading"></a></h3>
<table class="docutils align-default">
<colgroup>
<col style="width: 13%" />
<col style="width: 43%" />
<col style="width: 8%" />
<col style="width: 15%" />
<col style="width: 8%" />
<col style="width: 12%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Typical</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>THD4</p></td>
<td><p>Total Harmonic
Distortion</p></td>
<td><p>56</p></td>
<td><p>60</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-odd"><td><p>SNR4</p></td>
<td><p>Signal to Noise Ration</p></td>
<td><p>49</p></td>
<td><p>51</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-even"><td><p>SFDR4</p></td>
<td><p>Spurious Free Dynamic
Range (including
Harmonics)</p></td>
<td><p>58</p></td>
<td><p>60</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-odd"><td><p>SFDR4</p></td>
<td><p>Spurious Free Dynamic
Range (excluding
Harmonics)</p></td>
<td><p>68</p></td>
<td><p>73</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-even"><td><p>SINAD4</p></td>
<td><p>Signal-to-Interference
Ratio including Noise
and Distortion</p></td>
<td><p>49</p></td>
<td><p>51</p></td>
<td></td>
<td><p>dB</p></td>
</tr>
<tr class="row-odd"><td><p>ENOB4</p></td>
<td><p>Effective Number of Bits</p></td>
<td><p>7,9</p></td>
<td><p>8,1</p></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="electrical-characteristics">
<h2><span class="sectnum">6.2</span> Electrical Characteristics<a class="headerlink" href="#electrical-characteristics" title="Permalink to this heading"></a></h2>
<section id="oscillator">
<h3><span class="sectnum">6.2.1</span> Oscillator<a class="headerlink" href="#oscillator" title="Permalink to this heading"></a></h3>
<p>The <strong>Ndigo5G</strong> uses an OCXO oscillator with <strong>25ppb</strong> stability. After power up
the oscillator needs to run for <strong>10 minutes</strong> to reach this stability.</p>
</section>
<section id="environmental-conditions-for-operation">
<h3><span class="sectnum">6.2.2</span> Environmental Conditions for Operation<a class="headerlink" href="#environmental-conditions-for-operation" title="Permalink to this heading"></a></h3>
<p>The board is designed to be operated under the following conditions:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 29%" />
<col style="width: 7%" />
<col style="width: 11%" />
<col style="width: 7%" />
<col style="width: 35%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Typical</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>T</p></td>
<td><p>ambient
temperature</p></td>
<td><p>5</p></td>
<td></td>
<td><p>40</p></td>
<td><p><span class="math notranslate nohighlight">\(^{\circ}\)</span>C</p></td>
</tr>
<tr class="row-odd"><td><p>RH</p></td>
<td><p>relative
humidity at
31<span class="math notranslate nohighlight">\(^{\circ}\)</span>C</p></td>
<td><p>20</p></td>
<td></td>
<td><p>75</p></td>
<td><p>%</p></td>
</tr>
</tbody>
</table>
</section>
<section id="environmental-conditions-for-storage">
<span id="enviro-store"></span><h3><span class="sectnum">6.2.3</span> Environmental Conditions for Storage<a class="headerlink" href="#environmental-conditions-for-storage" title="Permalink to this heading"></a></h3>
<p>The board shall be stored between operation under the following
conditions:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 36%" />
<col style="width: 7%" />
<col style="width: 11%" />
<col style="width: 7%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Typical</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>T</p></td>
<td><p>ambient
temperature</p></td>
<td><p>-30</p></td>
<td></td>
<td><p>60</p></td>
<td><p><span class="math notranslate nohighlight">\(^{\circ}\)</span>C</p></td>
</tr>
<tr class="row-odd"><td><p>RH</p></td>
<td><p>relative
humidity at
31<span class="math notranslate nohighlight">\(^{\circ}\)</span>C
non condensing</p></td>
<td><p>10</p></td>
<td></td>
<td><p>70</p></td>
<td><p>%</p></td>
</tr>
</tbody>
</table>
</section>
<section id="power-supply">
<h3><span class="sectnum">6.2.4</span> Power Supply<a class="headerlink" href="#power-supply" title="Permalink to this heading"></a></h3>
</section>
<section id="analog-input">
<h3><span class="sectnum">6.2.5</span> Analog Input<a class="headerlink" href="#analog-input" title="Permalink to this heading"></a></h3>
<p>AC coupled single-ended analog inputs (standard version).</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 20%" />
<col style="width: 35%" />
<col style="width: 8%" />
<col style="width: 9%" />
<col style="width: 7%" />
<col style="width: 20%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Typical</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\({V}\)</span> p-p</p></td>
<td><p>Peak to peak input voltage</p></td>
<td></td>
<td></td>
<td><p>0,5</p></td>
<td><p>V</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\({Z}\)</span> p</p></td>
<td><p>input impedance</p></td>
<td></td>
<td><p>50</p></td>
<td></td>
<td><p><span class="math notranslate nohighlight">\(\Omega\)</span></p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p>Analog offset</p></td>
<td><p>-0,25</p></td>
<td></td>
<td><p>0,25</p></td>
<td><p>V</p></td>
</tr>
</tbody>
</table>
<p>AC coupled differential analog inputs (S version).</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 23%" />
<col style="width: 35%" />
<col style="width: 7%" />
<col style="width: 9%" />
<col style="width: 7%" />
<col style="width: 19%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Typical</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\({V}\)</span> com</p></td>
<td><p>Input common mode</p></td>
<td><p>-4</p></td>
<td></td>
<td><p>6</p></td>
<td><p>V</p></td>
</tr>
<tr class="row-odd"><td><p><span class="math notranslate nohighlight">\({V}\)</span> p-p</p></td>
<td><p>Differential input Voltage</p></td>
<td><p>-125</p></td>
<td></td>
<td><p>125</p></td>
<td><p>mV</p></td>
</tr>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\({Z}\)</span> p</p></td>
<td><p>Input impedance</p></td>
<td></td>
<td><p>100</p></td>
<td></td>
<td><p><span class="math notranslate nohighlight">\(\Omega\)</span></p></td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p>Analog offset</p></td>
<td><p>-0,25</p></td>
<td></td>
<td><p>+0.25</p></td>
<td><p>V</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id89">
<h3><span class="sectnum">6.2.6</span> Analog inputs<a class="headerlink" href="#id89" title="Permalink to this heading"></a></h3>
<p>Single ended AC coupled inputs Trigger and GATE with configurable DC
offset bias.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 11%" />
<col style="width: 30%" />
<col style="width: 11%" />
<col style="width: 13%" />
<col style="width: 11%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Symbol</p></th>
<th class="head"><p>Parameter</p></th>
<th class="head"><p>Min</p></th>
<th class="head"><p>Typical</p></th>
<th class="head"><p>Max</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>V</p></td>
<td><p>Pulse height</p></td>
<td></td>
<td></td>
<td><p>5.0</p></td>
<td><p>V</p></td>
</tr>
<tr class="row-odd"><td><p>V</p></td>
<td><p>DC offset</p></td>
<td><p>-1.25</p></td>
<td></td>
<td><p>1.25</p></td>
<td><p>V</p></td>
</tr>
<tr class="row-even"><td><p>V</p></td>
<td><p>DC offset for TDC</p></td>
<td><p>-1.25</p></td>
<td></td>
<td><p>-0.01</p></td>
<td><p>V</p></td>
</tr>
<tr class="row-odd"><td><p>Z</p></td>
<td><p>input impedance</p></td>
<td></td>
<td><p>50</p></td>
<td></td>
<td><p><span class="math notranslate nohighlight">\(\Omega\)</span></p></td>
</tr>
<tr class="row-even"><td><p>t</p></td>
<td><p>pulse width</p></td>
<td><p>7</p></td>
<td></td>
<td><p>100</p></td>
<td><p>ns</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="information-required-by-din-en-61010-1">
<h2><span class="sectnum">6.3</span> Information Required by DIN EN 61010-1<a class="headerlink" href="#information-required-by-din-en-61010-1" title="Permalink to this heading"></a></h2>
<section id="manufacturer">
<h3><span class="sectnum">6.3.1</span> Manufacturer<a class="headerlink" href="#manufacturer" title="Permalink to this heading"></a></h3>
<p>The <strong>Ndigo5G</strong> is a product of:</p>
<blockquote>
<div><p>cronologic GmbH &amp; Co. KG</p>
<p>Jahnstraße 49</p>
<p>60318 Frankfurt</p>
<p>HRA 42869 beim Amtsgericht Frankfurt/M</p>
<p>VAT-ID: DE235184378</p>
</div></blockquote>
</section>
<section id="intended-use-and-system-integration">
<h3><span class="sectnum">6.3.2</span> Intended Use and System Integration<a class="headerlink" href="#intended-use-and-system-integration" title="Permalink to this heading"></a></h3>
<p>The devices are not ready to use as delivered by cronologic. It requires
the development of specialized software to fulfill the application of
the end user. The device is provided to system integrators to be built
into measurement systems that are distributed to end users. These
systems usually consist of a the <strong>Ndigo5G</strong>, a main board, a case,
application software and possible additional electronics to attach the
system to some type of detector. They might also be integrated with the
detector.</p>
<p>The <strong>Ndigo5G</strong> is designed to comply with <strong>DIN EN 61326-1</strong> when operated on a
PCIe compliant main board housed in a properly shielded enclosure. When
operated in a closed standard compliant PC enclosure the device does not
pose any hazards as defined by <strong>EN 61010-1.</strong></p>
<p>Radiated emissions, noise immunity and safety highly depend on the
quality of the enclosure. It is the responsibility of the system
integrator to ensure that the assembled system is compliant to
applicable standards of the country that the system is operated in,
especially with regards to user safety and electromagnetic interference.
Compliance was only tested for attached cables shorter than <strong>3m.</strong></p>
<p>When handling the board, adequate measures have to be taken to protect
the circuits against electrostatic discharge (ESD). All power supplied
to the system must be turned off before installing the board.</p>
</section>
<section id="cooling">
<h3><span class="sectnum">6.3.3</span> Cooling<a class="headerlink" href="#cooling" title="Permalink to this heading"></a></h3>
<p>The <strong>Ndigo5G</strong> in its base configuration has passive cooling that requires
a certain amount of air flow. If the case design can’t provide enough
air flow to the board, a slot cooler like Zalman ZM-SC100 can be placed
next to the board. Active cooling is also available as an option to the
board.</p>
</section>
<section id="environmental-conditions">
<h3><span class="sectnum">6.3.4</span> Environmental Conditions<a class="headerlink" href="#environmental-conditions" title="Permalink to this heading"></a></h3>
<p>See Section 6.2.2 and Section 6.2.3.</p>
</section>
<section id="inputs">
<h3><span class="sectnum">6.3.5</span> Inputs<a class="headerlink" href="#inputs" title="Permalink to this heading"></a></h3>
<p>All inputs are AC coupled. The inputs have very high input bandwidth
requirements and therefore there are no circuits that provide over
voltage protection for these signals. Any voltage on the inputs above <strong>5V</strong>
or below <strong>-5V</strong> relative to the voltage of the slot cover can result in
permanent damage to the board.</p>
</section>
<section id="known-bugs">
<h3><span class="sectnum">6.3.6</span> Known Bugs<a class="headerlink" href="#known-bugs" title="Permalink to this heading"></a></h3>
<p>The Ndigo5G does not work in most Thunderbolt PCIe extension enclosures.
The reason is unknown.</p>
</section>
<section id="workarounds">
<h3><span class="sectnum">6.3.7</span> Workarounds<a class="headerlink" href="#workarounds" title="Permalink to this heading"></a></h3>
<p>Use <strong>Ndigo6G</strong> All other cronologic products work reliably in Thunderbolt
enclosures. The Ndigo6G offers very similar functionality to the
<strong>Ndigo5G</strong> at a higher performance. When using the Ndigo6G as a
replacement, there are some software changes required in the device
configuration. The readout data format and API is identical. See
<a class="reference external" href="https://www.cronologic.de/products/adcs/ndigo6g-12">www.cronologic.de/products/adcs/ndigo6g-12</a>
for details.</p>
<p>Use Ndigo Crate Up to eight <strong>Ndigo5G</strong> can be used in an Ndigo Crate connected to a
PC. Electrically the setup is similar to an external Thunderbolt
enclosure, but the PC must have a vacant PCIe slot.
See
<a class="reference external" href="https://www.cronologic.de/products/pcie/pcie-crates">www.cronologic.de/products/pcie/pcie-crates</a>
for details.</p>
<p>All other cronogic products work reliably in Thundberbolt enclosure.
Consider using an <strong>Ndigo6G</strong> as a replace</p>
</section>
<section id="recycling">
<h3><span class="sectnum">6.3.8</span> Recycling<a class="headerlink" href="#recycling" title="Permalink to this heading"></a></h3>
<p>cronologic is registered with the “Stiftung Elektro-Altgeräte Register”
as a manufacturer of electronic systems with <strong>Registration ID DE
77895909.</strong></p>
<p>The <strong>Ndigo5G</strong> belongs to <strong>category 9</strong>, <strong>“Überwachungs und Kontrollinstrumente
für ausschließlich gewerbliche Nutzung”.</strong> The last owner of an <strong>Ndigo5G</strong>
must recycle it, treat the board in compliance with <strong>§11</strong> and <strong>§12</strong> of the
German ElektroG, or return it to the manufacturer’s address listed on
page 48.</p>
</section>
<section id="export-control">
<h3><span class="sectnum">6.3.9</span> Export Control<a class="headerlink" href="#export-control" title="Permalink to this heading"></a></h3>
<p>The <strong>Ndigo5G</strong> product line is a dual use item under
<a class="reference external" href="https://data.europa.eu/eli/reg/2009/428/2021-10-077">Council Regulation (EC) No 428/2009 of 5 May 2009 setting up a Community regime for the
control of exports, transfer, brokering and transit of dual-use
items</a> in
section <strong>3A002h.</strong> Similar regulations exist in many countries outside Europe.</p>
<p>An export permit is required to export this product from the European
Community (EC) which will cause additional lead time. When ordering from
outside the EC, the seller will ask you for additional information
needed to obtain this permit.</p>
<p>Before reexporting an <strong>Ndigo5G</strong> or any product containing an Ndigo5G as a
component please check you local regulations whether an export permit is
required.</p>
</section>
</section>
</section>
<section id="revision-history">
<h1><span class="sectnum">7</span> Revision History<a class="headerlink" href="#revision-history" title="Permalink to this heading"></a></h1>
<section id="firmware">
<h2><span class="sectnum">7.1</span> Firmware<a class="headerlink" href="#firmware" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 22%" />
<col style="width: 16%" />
<col style="width: 62%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Revision</p></th>
<th class="head"><p>Date</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1.4865</p></td>
<td><p>2015-07-28</p></td>
<td><p>Internal optimizations</p></td>
</tr>
<tr class="row-odd"><td><p>1.4824</p></td>
<td><p>2015-02-27</p></td>
<td><p>Fixed intel PCIe link training issues</p></td>
</tr>
</tbody>
</table>
</section>
<section id="driver-applications">
<h2><span class="sectnum">7.2</span> Driver &amp; Applications<a class="headerlink" href="#driver-applications" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 18%" />
<col style="width: 55%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Revision</p></th>
<th class="head"><p>Date</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1.4.3</p></td>
<td><p>2019-10-21</p></td>
<td><p>Fixed a card initialization error
in x64 32 mode</p></td>
</tr>
<tr class="row-odd"><td><p>1.4.0</p></td>
<td><p>2019-06-04</p></td>
<td><p>Added Windows 10 support</p></td>
</tr>
<tr class="row-even"><td><p>1.3.0</p></td>
<td><p>2017-06-08</p></td>
<td><p>NdigoScope application now
supports Ndigo250M-14</p></td>
</tr>
</tbody>
</table>
</section>
<section id="user-guide">
<h2><span class="sectnum">7.3</span> User Guide<a class="headerlink" href="#user-guide" title="Permalink to this heading"></a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 26%" />
<col style="width: 18%" />
<col style="width: 56%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Revision</p></th>
<th class="head"><p>Date</p></th>
<th class="head"><p>Comments</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1.1.0</p></td>
<td><p>2019-08-27</p></td>
<td><p>API clarifications</p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to Ndigo’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Ndigo_PackForm.html" class="btn btn-neutral float-right" title="1. Packet Format" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sulima.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>