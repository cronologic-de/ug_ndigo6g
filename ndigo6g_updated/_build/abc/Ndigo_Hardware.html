<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2.0 Hardware &mdash; Ndigo 1.0 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> Ndigo
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="Ndigo_Intro.html">1.0 Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="Ndigo_Intro.html#hardware">2.0 Hardware</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Ndigo_PackForm.html">4.0 Packet Format</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Ndigo_CExp.html">5.0 C-Example</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Ndigo_Tech.html">6.0 Technical Data</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Ndigo</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">2.0 Hardware</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Ndigo_Hardware.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="hardware">
<h1>2.0 Hardware<a class="headerlink" href="#hardware" title="Permalink to this heading"></a></h1>
<section id="installing-the-board">
<h2>2.1 Installing the Board<a class="headerlink" href="#installing-the-board" title="Permalink to this heading"></a></h2>
<p>The <strong>Ndigo5G board</strong> can be installed in any x4 (or higher amount of lanes)
PCIe slot. If the slot electrically supports less than 4 lanes, the
board will operate at lowerdata throughput rates.</p>
<p>Please ensure proper cooling of the device. The <strong>Ndigo5G</strong> has an onboard
temperature detection. If the ADC chip temperature exceeds
90C a warning is issued to the device driver. In
case the temperature is higher than 95C the ADC is
disabled to avoid damage. Using a PCI-slot cooler is in many cases an
appropriate solution to circumvent problems caused by overheating if the
board is used inside a PC. The Ndigo-Crate will provide sufficient
cooling under normal operating conditions.</p>
<p>Using a single <strong>Ndigo5G</strong>, no further connections need to be made.</p>
<p>For applications that require more than 4 ADC channels, several Ndigo boards
can be operated in sync. Any board of the <strong>Ndigo product line</strong> can be
synced to other Ndigo boards, allowing, for instance, for a combination
of high speed ADCs (<strong>Ndigo5G</strong>) and slower high resolution ADCs
(<strong>Ndigo250M-14</strong>).</p>
<p>The signals used for board synchronization and inter-board triggering
are transferred on a bus be-tween the boards. Join all C2 connectors
(see Figure <a class="reference external" href="#target-fig4">Fig 2.3</a>  ) on the
boards using a ribbon cable. Both ends of the bus need to be terminated
properly. If using a <strong>Ndigo Crate</strong>, connectors providing the termination
are located on the crate mainboard next to the PCIe slots to the extreme
left and right. &lt;more details, peas.e refer to the Ndigo Crate user
guide. In applications that use only a few Ndigo boards installed
directly inside a PC, termination PCBs available from cronologic can be
used.</p>
<p><strong>Ndigo5G’s</strong> standard device driver can be used to read out all boards and
acquire data. For more complex scenarios, using the cronoSync-library,
which is part of cronoTools, is recommended. The cronoSync library is
provided with the Ndigo device driver. Please refer to the cronoTools
user guide for more information.</p>
<figure class="align-default" id="id17">
<a class="reference internal image-reference" href="_images/fig2.1.png"><img alt="alternative text" src="_images/fig2.1.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.1: If several Ndigo boards are connected to work in sync, the boards
must be connected using a ribbon cable as bus for synchronization and
trigger signals. Proper termination is required at both ends of the cable.</span><a class="headerlink" href="#id17" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="ndigo5g-external-inputs-and-connectors">
<h2>2.2 Ndigo5G External Inputs and Connectors<a class="headerlink" href="#ndigo5g-external-inputs-and-connectors" title="Permalink to this heading"></a></h2>
<section id="connectors">
<h3>2.2.1 Connectors<a class="headerlink" href="#connectors" title="Permalink to this heading"></a></h3>
<p>The inputs of the <strong>Ndigo5G</strong> are located on the PCI bracket. Figure
<a class="reference external" href="#target-fig4">Fig 2.3</a> on page shows the location of the
4 analog inputs A to D and the two digital inputs G (GATE) and T
(Trigger). Furthermore, two board interconnection connectors can be
found at the top edge of the <strong>Ndigo5G</strong>, as displayed in Figure
<a class="reference external" href="#target-fig4">Fig 2.3</a> on page . Connector C1 is used
for a board-to-board connection (e. g. to link a HPTDC8-PCI and a
<strong>Ndigo5G</strong> via a <strong>Ndigo Extension board</strong>, see chapter 2.3).
Connector C2 is used as a bus interface
between multiple Ndigo boards distributing clock, trigger and sync
signals. Proper termination must be placed at both ends of the bus
interconnection ribbon cable.</p>
<figure class="align-default" id="id18">
<a class="reference internal image-reference" href="_images/fig2.2.png"><img alt="alternative text" src="_images/fig2.2.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.2: Input connectors of an Ndigo5G located on the PCI bracket.</span><a class="headerlink" href="#id18" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id19">
<span id="target-fig4"></span><a class="reference internal image-reference" href="_images/fig2.3.png"><img alt="alternative text" src="_images/fig2.3.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.3: Ndigo5G board showing inter-board connectors C1 and C2.</span><a class="headerlink" href="#id19" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="analog-inputs">
<h3>2.2.2 Analog Inputs<a class="headerlink" href="#analog-inputs" title="Permalink to this heading"></a></h3>
<figure class="align-default" id="id20">
<span id="target-fig5"></span><a class="reference internal image-reference" href="_images/fig2.4.png"><img alt="alternative text" src="_images/fig2.4.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.3: Input circuit for each of the four analog channels.</span><a class="headerlink" href="#id20" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>The analog inputs of the ADC are single ended LEMO00 coax connectors.
The inputs have a <span class="math notranslate nohighlight">\(50\Omega\)</span> impedance and are AC coupled. The
inputs are converted to a differential signal using a balun.</p>
</section>
<section id="analog-offsets">
<h3>Analog Offsets<a class="headerlink" href="#analog-offsets" title="Permalink to this heading"></a></h3>
<p>AC coupling removes the common mode voltage from the input signal. Users
can move the common mode voltage to a value of their choice using the
analogoffset parameter of each channel before sampling.</p>
<p>This feature is useful for highly asymmetric signals, such as pulses
from TOF spectrometers or LIDAR systems. Without analog offset
compensation, the pulses would begin in the middle of the ADC range,
effectively cutting the dynamic range in half (see Figure <a class="reference external" href="target-fig7">Fig 2.6</a> ). By shifting the DC baseline to
one end of the ADC range, the input range can be used fully, providing
the maximum dynamic range. The analog offset can be set between
<span class="math notranslate nohighlight">\(\pm 0,25V\)</span>.</p>
<figure class="align-default" id="id21">
<a class="reference internal image-reference" href="_images/fig2.5.png"><img alt="alternative text" src="_images/fig2.5.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.5: Users can add analog offset to the input before sampling</span><a class="headerlink" href="#id21" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id22">
<span id="target-fig7"></span><a class="reference internal image-reference" href="_images/fig2.6.png"><img alt="alternative text" src="_images/fig2.6.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.6: Asymmetric signal shifted to increase dynamic range</span><a class="headerlink" href="#id22" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="digital-inputs">
<h3>2.2.3 Digital Inputs<a class="headerlink" href="#digital-inputs" title="Permalink to this heading"></a></h3>
<p>There are two digital inputs on the front slot cover called Trigger and
Gate.</p>
<p>Both inputs provide a digital input signal routed to the trigger matrix.
These signals can be used to trigger any of the trigger state machines
and gating blocks. The inputs are AC coupled. DC offset is configurable
via the dcoffset parameter in the configurations structure to support
positive and negative input pulses. dcoffset[1] is the offset for the
Trigger input and dcoffset[0] is the offset for the GATE input.</p>
<p>The configuration is set via the structures trigger for the Trigger
input and trigger[NDIGOTRIGGERGATE] for the GATE input. The input
circuit is shown in Figure <a class="reference external" href="#fig:DigitalInput">[fig:DigitalInput]</a> on
page .</p>
</section>
<section id="tdc-on-trigger-input">
<h3>TDC on Trigger Input<a class="headerlink" href="#tdc-on-trigger-input" title="Permalink to this heading"></a></h3>
<p>There is a TDC connected to the Trigger input. When used with the TDC,
the Trigger input supports negative pulses only . The TDC creates
packets of type 8. These packets first contain a coarse timestamp and a
payload that can be used to calculate the trigger position with higher
precision. The function ndigoprocesstdcpacket() can be used to replace
the coarse timestamp with the precise timestamp. This function is
described in section <a class="reference external" href="#cp:readout">[cp:readout]</a> on page . TDC pulses
must have a minimum duration of 3.3ns. The dead-time of the TDC is 32ns.</p>
<p>NDIGOTRIGGERTDC is an alias for NDIGOTRIGGERTRIGGER.</p>
</section>
</section>
<section id="extension-card">
<h2>2.3 Extension Card<a class="headerlink" href="#extension-card" title="Permalink to this heading"></a></h2>
<p>The Ndigo Extension card provides additional inputs or outputs to the
FPGA. It is connected to the Samtec QSS-025 connector on an Ndigo5G by
an Samtec SQCD cable assembly.</p>
<p>The Ndigo Extension Card provides up to ten single ended LEMO00
connectors. The circuit connecting to each of these circuits can be
chosen to provide inputs or outputs. These can be AC or DC coupled. AC
coupled inputs support NIM signaling. The signals connect to 2.5V IO
Pins of the Xilinx Virtex-5 FPGA.</p>
<p>The current firmware revision provides the following signal connections.
The HPTDC clocks are
<span class="math notranslate nohighlight">\(\SI{5}{\giga\hertz} / 128 = \SI{39.0625}{\mega\hertz}\)</span></p>
<div class="small docutils container">
<div class="center docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 14%" />
<col style="width: 16%" />
<col style="width: 17%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Connector</p></th>
<th class="head"><p>QSS Pin</p></th>
<th class="head"><p>FPGA Pin</p></th>
<th class="head"><p>Direction</p></th>
<th class="head"><p>Signal</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>LEMO00: CH0</p></td>
<td><p>22</p></td>
<td><p>AD9</p></td>
<td><p>Input</p></td>
<td><p>Ndigo Extension
digital channel
0</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH1</p></td>
<td><p>18</p></td>
<td><p>AE10</p></td>
<td><p>Input</p></td>
<td><p>Ndigo Extension
digital channel
1</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH2</p></td>
<td><p>14</p></td>
<td><p>D10</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>not connected</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH3</p></td>
<td><p>10</p></td>
<td><p>AF9</p></td>
<td><p>Output</p></td>
<td><p>39.0625 MHz
clock for HPTDC</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH4</p></td>
<td><p>6</p></td>
<td><p>AD11</p></td>
<td><p>Output</p></td>
<td><p>39.0625 MHz
clock for HPTDC</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH5</p></td>
<td><p>5</p></td>
<td><p>AE7</p></td>
<td><p>Output</p></td>
<td><p>39.0625 MHz
clock for HPTDC</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH6</p></td>
<td><p>9</p></td>
<td><p>AF7</p></td>
<td><p>Output</p></td>
<td><p>39.0625 MHz
clock for HPTDC</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH7</p></td>
<td><p>13</p></td>
<td><p>D9</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>not connected</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH8</p></td>
<td><p>17</p></td>
<td><p>V9</p></td>
<td><p>Input</p></td>
<td><p>Ndigo Extension
digital channel
2</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH9</p></td>
<td><p>21</p></td>
<td><p>W9</p></td>
<td><p>Input</p></td>
<td><p>Ndigo Extension
digital channel
3</p></td>
</tr>
<tr class="row-even"><td><p>SYNC1:
Sync-TDC8</p></td>
<td><p>26</p></td>
<td><p>F9</p></td>
<td><ul class="simple">
<li></li>
</ul>
</td>
<td><p>not connected</p></td>
</tr>
<tr class="row-odd"><td><p>SYNC1:
Sync-HPTDC</p></td>
<td><p>44</p></td>
<td><p>AA7</p></td>
<td><p>Output</p></td>
<td><p>Sync for HPTDC</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The 4 digital inputs are routed to the bus inputs of the trigger matrix
to be used for triggering. The routing can be configured to either ORing
the sync bus and extension channels or use the extension channels
exclusively.</p>
<div class="center docutils container">
<table class="docutils align-default">
<colgroup>
<col style="width: 16%" />
<col style="width: 22%" />
<col style="width: 34%" />
<col style="width: 28%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>Connector</p></td>
<td><p>Extension Card</p></td>
<td><p>Trigger matrix input</p></td>
<td><p>Trigger matrix input</p></td>
</tr>
<tr class="row-even"><td></td>
<td><p>Digital Channel</p></td>
<td><p>ignorecable = 0</p></td>
<td><p>ignorecable = 1</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH0</p></td>
<td><p>0</p></td>
<td><p>BUS0 = EXT0  Sync Cable 0</p></td>
<td><p>BUS0 = EXT0</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH1</p></td>
<td><p>1</p></td>
<td><p>BUS1 = EXT1  Sync Cable 1</p></td>
<td><p>BUS1 = EXT1</p></td>
</tr>
<tr class="row-odd"><td><p>LEMO00: CH8</p></td>
<td><p>2</p></td>
<td><p>BUS2 = EXT2  Sync Cable 2</p></td>
<td><p>BUS2 = EXT2</p></td>
</tr>
<tr class="row-even"><td><p>LEMO00: CH9</p></td>
<td><p>3</p></td>
<td><p>BUS3 = EXT3  Sync Cable 3</p></td>
<td><p>BUS3 = EXT3</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="ndigo5g-functionality">
<h2>2.4 Ndigo5G Functionality<a class="headerlink" href="#ndigo5g-functionality" title="Permalink to this heading"></a></h2>
<section id="adc-modes">
<h3>2.4.1 ADC Modes<a class="headerlink" href="#adc-modes" title="Permalink to this heading"></a></h3>
<p>Depending on board configuration, the analog input signal is quantized
to 8 or 10 bits. However, the board always scales and offsets the data
to 16 bit signed data centered around 0.</p>
<p>Data processing such as trigger detection or packet building are always
performed on 3.2ns intervals. Depending on the ADC mode, this interval
may contain 4, 8 or 16 samples.</p>
<p>The board supports using one, two or four channels:</p>
</section>
<section id="channel-modes-a-b-c-and-d">
<h3>1 Channel Modes A, B, C and D<a class="headerlink" href="#channel-modes-a-b-c-and-d" title="Permalink to this heading"></a></h3>
<p>In these modes, only a single channel is used. The analog signal on that
channel is digitized at 5Gsps. Packet size is always a multiple of 16
samples per 3.2ns. See Figure <a class="reference external" href="#fig:1ChannelMode">[fig:1ChannelMode]</a>
on page and Figure
<a class="reference external" href="#fig:1ChannelTriggering">[fig:1ChannelTriggering]</a> on page .</p>
</section>
<section id="channel-modes-ac-bc-ad-and-bd">
<h3>2 Channel Modes AC, BC, AD and BD<a class="headerlink" href="#channel-modes-ac-bc-ad-and-bd" title="Permalink to this heading"></a></h3>
<p>In these modes, two channels are used simultaneously. The analog signals
on these channels are digitized at 2.5Gsps each. Packet size is always a
multiple of 8 samples per 3.2ns. See Figure
<a class="reference external" href="#fig:2ChannelMode">[fig:2ChannelMode]</a> on page and Figure
<a class="reference external" href="#fig:2ChannelTriggering">[fig:2ChannelTriggering]</a> on page .</p>
</section>
<section id="channel-mode-abcd">
<h3>4 Channel Mode ABCD<a class="headerlink" href="#channel-mode-abcd" title="Permalink to this heading"></a></h3>
<p>In this mode, all four channels are digitized independently at 1.25Gsps
each. The packet size is always a multiple of 4 samples per 3.2ns. See
Figure <a class="reference external" href="#fig:4ChannelMode">[fig:4ChannelMode]</a> on page and Figure
<a class="reference external" href="#fig:4ChannelTriggering">[fig:4ChannelTriggering]</a> on page .</p>
</section>
<section id="multiple-sampling-modes-aaaa-bbbb-cccc-and-dddd">
<h3>Multiple Sampling Modes AAAA, BBBB, CCCC and DDDD<a class="headerlink" href="#multiple-sampling-modes-aaaa-bbbb-cccc-and-dddd" title="Permalink to this heading"></a></h3>
<p>In these modes, only one analog input channel is used, but the channel
is sampled independently and simultaneously by four ADCs at 1.25Gsps.
The board creates four independent streams with 4 samples each per
3.2ns.</p>
<p>Using the same trigger setting on all ADCs, can be used to reduce noise
by averaging the four channels. To deal with complex triggering
conditions, different trigger settings on each of the ADCs can be used.</p>
<p>The Ndigo5G provides 4 ADCs sampling at 1.25Gsps each. Higher speed
modes are implemented by interleaving two or four of these ADCs.</p>
<p>During interleaving, the Ndigo5G firmware reorders and groups the data
into a linear sample stream. The process is fully transparent. For
users, the only difference is that a 3.2ns cycle can contain 4, 8 or 16
samples, depending on mode.</p>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
</section>
<section id="zero-suppression">
<h3>2.4.2 Zero Suppression<a class="headerlink" href="#zero-suppression" title="Permalink to this heading"></a></h3>
<p>One of Ndigo5G’s key features is on-board zero suppression to reduce
PCIe bus load. Only data that passes specifications predefined by the
user is transmitted. This guide refers to transmitted waveform data as
“packets”. A packet contains the waveform data and a timestamp giving
the absolute time (i.e. the time since start of data acquisition) of the
packet’s last sample.</p>
<p>Figure <a class="reference external" href="#fig:ZeroSupp">[fig:ZeroSupp]</a> shows a simple example: Data
is written to the PC only if values exceed a specified threshold.
Expanding on that, Ndigo5G’s zero suppression can be used to realize
much more complex scenarios.</p>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
</section>
<section id="trigger-blocks">
<h3>2.4.3 Trigger Blocks<a class="headerlink" href="#trigger-blocks" title="Permalink to this heading"></a></h3>
<p>Ndigo5G-10 and Ndigo5G-8 record analog waveforms using zero suppression.
Whenever a relevant waveform is detected, data is written to an internal
FIFO memory. Each ADC channel has one trigger block determining whether
data is written to the FIFO. The parameters are set in Structure
ndigotriggerblock(See chapter <a class="reference external" href="#cp:triggerblock">[cp:triggerblock]</a>
on page ).</p>
<p>Each trigger block consists of two independent units that check the
incoming raw data stream for trigger conditions (Fig.
<a class="reference external" href="#fig:ZeroSupp">[fig:ZeroSupp]</a> on page ). Users can specify a
threshold and can choose whether triggering is used whenever incoming
data is below or above the threshold (level triggering) or only if data
exceeds the threshold (edge triggering).</p>
<p>A gate length can be set to extend the trigger window by multiples of
3.2ns. Furthermore, if users choose precursor values <span class="math notranslate nohighlight">\(&gt; 0\)</span>, the
trigger unit will start writing data to the FIFO
<span class="math notranslate nohighlight">\(\text{precursor}\cdot 3.2ns\)</span> before the trigger event.</p>
<p>When using edge triggering, all packets have the same length (Figure
<a class="reference external" href="#fig:edge-trigger">[fig:edge-trigger]</a> on page ):
<span class="math notranslate nohighlight">\(\text{precursor}+\text{length}+1\)</span> cycles of 3.2ns. For level
triggering, packet length is data dependent (Figure
<a class="reference external" href="#fig:level-trigger">[fig:level-trigger]</a> on page ).</p>
<p>Please note that triggering is not accurate to sample. For each 3.2ns
clock cycle, it is determined whether on any sample during that clock
cycle a trigger condition is met. The clock cycle is then selected as
the trigger point. As a result, the trigger sample can be anywhere
within a range of up to 16 samples in single channel mode (Figure
<a class="reference external" href="#fig:1ChannelTriggering">[fig:1ChannelTriggering]</a> on page ) at 16
samples per 3.2ns.</p>
<p>If retriggering is active, the current trigger window is extended if a
trigger event is detected inside the window.</p>
<p>A trigger block can use several input sources:</p>
<ul class="simple">
<li><p>the 8 trigger decision units of all four ADC channels (Figure
<a class="reference external" href="#fig:analog-trigger">[fig:analog-trigger]</a> on page )</p></li>
<li><p>the GATE input (Figure <a class="reference external" href="#fig:DigitalInput">[fig:DigitalInput]</a> on
page )</p></li>
<li><p>the Trigger or TDC input, (Figure
<a class="reference external" href="#fig:DigitalInput">[fig:DigitalInput]</a> on page )</p></li>
<li><p>a function trigger providing random or periodic triggering (Section
<a class="reference external" href="#cp:AutoTriggeringFunctionGenerator">[cp:AutoTriggeringFunctionGenerator]</a>
on page )</p></li>
<li><p>triggers originating from other cards connected with the sync cable
or from the Ndigo Extension card (BUS0, BUS1, BUS2, BUS3)</p></li>
<li><p>A second set of trigger units with names ending in pe for the digital
inputs Trigger, GATE, BUS0, BUS1, BUS2, and BUS3 configured for
positive edge triggering. Together with the regular trigger units on
this inputs, both edges of a pulse can be used in the trigger logic.
This set of triggers is not available as inputs for the gate blocks.</p></li>
</ul>
<p>Trigger inputs from the above sources can be concatenated using logical
“OR” (Figure <a class="reference external" href="#fig:triggermatrix">[fig:triggermatrix]</a> on page ) by
setting the appropriate bits in the trigger blocks source mask.</p>
<p>Triggers can be fed into the gate blocks described on page (Figure
<a class="reference external" href="#fig:GatingBlock">[fig:GatingBlock]</a>). Gate blocks can be used to
block writing data to the FIFO. That way, only zero suppressed data
occurring when the selected gate is active is transmitted. This
procedure reduces PCIe bus load even further (Figure
<a class="reference external" href="#fig:GatingBlock">[fig:GatingBlock]</a>).</p>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
</section>
<section id="gating-blocks">
<h3>2.4.4 Gating Blocks<a class="headerlink" href="#gating-blocks" title="Permalink to this heading"></a></h3>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<p>To decrease the amount of data transmitted to the PC, Ndigo5G includes 4
independent gate and delay units. A gate and delay unit creates a gate
window starting at a specified time after a trigger, closing the window
at gate stop. Both timing values — gate start and gate stop — must be
set as multiples of 3.2ns.</p>
<p>Trigger blocks can use the gate signal to suppress data acquisition:
Only data that fulfills zero suppression specifications occurring in an
active gate window is written to the PC.</p>
<p>As input, any trigger from the 4 trigger blocks, the GATE and Trigger
inputs, a trigger from a connected board and the function generator can
be used.</p>
<p>The retrigger feature will create a new gate if a trigger occurs during
an active gate window. The gate signal can be inverted, causing an
active gate to close for a time defined by the user.</p>
<p>The parameters of a gating block are set in Structure ndigogatingblock
described on page .</p>
<p>Figure <a class="reference external" href="#fig:GateUDelay">[fig:GateUDelay]</a> shows the functionality of
the gate timing and delay unit. Active gate time is marked in green.</p>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
</section>
<section id="gating-example-1-suppression-of-noise-after-starting-an-acquisition">
<h3>Gating Example 1: Suppression of Noise After Starting an Acquisition<a class="headerlink" href="#gating-example-1-suppression-of-noise-after-starting-an-acquisition" title="Permalink to this heading"></a></h3>
<p>In mass spectrometer and other experiments, noise while starting data
acquisition can result in undesired trigger events for that time period.
To prevent noise in the output data, a gating block could be used to
suppress all triggers during start-up.</p>
<p>The following example illustrates the use of a gating block to prevent
noise: The GATE input transmits a pulse on each acquisition start. The
trigger structure of the GATE input is used to select pulse polarity.
Then, the GATE trigger is selected as gating block input and the gating
block’s start parameter is set to 0. The stop parameter is set to the
desired length measured in 3.2ns clock cycle and negate is set to true.
The gating block will now output a low pulse of the desired length
whenever there is a pulse on the GATE input.</p>
<p>Enabling this gating block as an AND input to the trigger block, for
which noise shall be suppressed.</p>
</section>
<section id="gating-example-2-delayed-trigger">
<h3>Gating Example 2: Delayed Trigger<a class="headerlink" href="#gating-example-2-delayed-trigger" title="Permalink to this heading"></a></h3>
<p>To sample a short window at a specified time after a trigger event on a
channel, the gating block can be used to create a delayed trigger. To do
this, one of the triggers of the channel of interested is configured to
the desired parameters by selecting the threshold, setting the edge
polarity and enabling edge triggering.</p>
<p>Instead of directly using this trigger as input to the trigger block’s
input matrix, the trigger is selected as an input to a gating block. The
block is configured to <span class="math notranslate nohighlight">\(start = delay\)</span> [in 3.2ns clock cycles] and
<span class="math notranslate nohighlight">\(stop = start+1\)</span>, <span class="math notranslate nohighlight">\(negate = false\)</span>. This causes the gating
block to produce a one clock cycle pulse on its output after the
specified delay.</p>
<p>To send this pulse to the trigger block, the gating block must be
enabled in the trigger block’s AND matrix and the ONE trigger source
must be selected.</p>
</section>
<section id="gating-example-3-dual-level-trigger">
<h3>Gating Example 3: Dual Level Trigger<a class="headerlink" href="#gating-example-3-dual-level-trigger" title="Permalink to this heading"></a></h3>
<p>The gates provide AND connections between each other (see fig.
<a class="reference external" href="#fig:triggermatrix">[fig:triggermatrix]</a>) which can be used for
example in a dual level trigger. For the acquisition of signal data with
amplitudes between a lower and an upper bound, for example, two level
triggers can be connected (see fig.
<a class="reference external" href="#fig:dualleveltrig">[fig:dualleveltrig]</a>): a falling level trigger
with an upper threshold and a rising level trigger with a lower
threshold.</p>
<p>Since the triggers are only connected by OR in the triggerblock logic
(see fig. <a class="reference external" href="#fig:triggermatrix">[fig:triggermatrix]</a>) they are
assigned to one of the gates each and connected with AND via the gating
block region of the trigger matrix (see fig.
<a class="reference external" href="#fig:triggermatrix">[fig:triggermatrix]</a> and
<a class="reference external" href="#fig:dualleveltriglogic">[fig:dualleveltriglogic]</a>). Because of the
dead times of the gates it is important to enable the retriggering
feature. Furthermore a precursor of 2 clock cycles is needed, because
the gates are delayed in relation to the ADC samples.</p>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<p>Config settings can be found in the following code snippet.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">config</span><span class="o">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">precursor</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="n">NDIGO_TRIGGER_SOURCE_ONE</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">trigger_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">gates</span> <span class="o">=</span> <span class="n">NDIGO_TRIGGER_GATE_0</span> <span class="o">|</span> <span class="n">NDIGO_TRIGGER_GATE_1</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">gating_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">retrigger</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">gating_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">gating_block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="n">NDIGO_TRIGGER_A0</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">gating_block</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">retrigger</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">gating_block</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">gating_block</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sources</span> <span class="o">=</span> <span class="n">NDIGO_TRIGGER_A1</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">trigger</span><span class="p">[</span><span class="n">NDIGO_TRIGGER_A0</span><span class="p">]</span><span class="o">.</span><span class="n">rising</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">trigger</span><span class="p">[</span><span class="n">NDIGO_TRIGGER_A0</span><span class="p">]</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">trigger</span><span class="p">[</span><span class="n">NDIGO_TRIGGER_A1</span><span class="p">]</span><span class="o">.</span><span class="n">rising</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">config</span><span class="o">.</span><span class="n">trigger</span><span class="p">[</span><span class="n">NDIGO_TRIGGER_A1</span><span class="p">]</span><span class="o">.</span><span class="n">threshold</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10000</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="auto-triggering-function-generator">
<h3>2.4.5 Auto Triggering Function Generator<a class="headerlink" href="#auto-triggering-function-generator" title="Permalink to this heading"></a></h3>
<p>Some applications require periodic or random triggering. Ndigo5G’s
function generator provides this functionality.</p>
<p>The delay between two trigger pulses of this trigger generator is the
sum of two components: A fixed value M and a pseudo random value given
by the exponent N.</p>
<p>The period is</p>
<div class="math notranslate nohighlight">
\[ \begin{align}\begin{aligned}\begin{aligned}
            T = 1 + M + [1...2^N]\\\end{aligned}\end{aligned}\end{align} \]</div>
<p>clock cycles with a duration of 3.2 ns per cycle.</p>
<p>This allows to monitor input signals at times the current trigger
configuration does not trigger, e. g. to get base line information in
mass spectrometry applications. It can also be used to determine a
suitable threshold level for the trigger by first getting random
statistics on the input signal.</p>
</section>
<section id="timestamp-channel">
<h3>2.4.6 Timestamp Channel<a class="headerlink" href="#timestamp-channel" title="Permalink to this heading"></a></h3>
<p>The timestamp channel produces a stream of small packets that denote the
time of the trigger event. An arbitrary set of trigger sources can be
selected in the trigger matrix to cause the creation of a packet.</p>
<p>The packets have a fixed length of 16 bytes. The format is described on
page . The length field of the packet contains a 32 bit pattern that
contains the levels of all trigger sources at the time of the trigger
event except for the period monitor. Only one packet is created, no
matter how many trigger sources caused the timestamp channel to trigger.</p>
</section>
<section id="data-lookup-table">
<h3>2.4.7 Data Lookup Table<a class="headerlink" href="#data-lookup-table" title="Permalink to this heading"></a></h3>
<p>In some applications it might be useful to modify the ADC sample data by
a user defined function <span class="math notranslate nohighlight">\(f(x)\)</span>. In this case the onboard FPGA is
able to perform this task such that the the data stream consists of data
words <span class="math notranslate nohighlight">\(f(sample)\)</span> instead of <span class="math notranslate nohighlight">\(sample\)</span>. The function f(x) is
applied using a 1024 word lookup table (LUT) which needs to be provided
by the user. This is done by defining the corresponding function as a
custom_lut-member of the ndigo_configuration structure. Please feel free
to contact cronologic if you plan the use this feature. The onboard INL
correction is applied prior to mapping the LUT values.</p>
</section>
</section>
<section id="multiple-ndigo-boards-synchronization">
<h2>2.5 Multiple Ndigo boards synchronization<a class="headerlink" href="#multiple-ndigo-boards-synchronization" title="Permalink to this heading"></a></h2>
<p>Using several Ndigo devices in applications that use more channels than
a single board can provide requires synchronized operation. To ensure
exact synchronization, a delay parameter needs to be set for each board.
This parameter might change in case boards are swapped, added or removed
and in some cases might change after a firmware update.</p>
<p>The calibration tool “MultiboardCalibration.exe” is available after
installing the Ndigo device driver. It is used to find appropriate delay
values for each board in a given board setup. After starting, the
application lists all Ndigo boards found (Figure
<a class="reference external" href="#fig:SyncCalibTool">[fig:SyncCalibTool]</a>).</p>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<p>A board’s appropriate delay depends on whether it operates in master or
slave mode. The respective values can be set in the column “Delay M”
(for master boards) and “Delay S” (for slave boards). The designated
master board can be selected in the column “Master”. The calibration
procedure creates a histogram for each board displaying the current
delay between the boards. The histogram can be viewed by clicking on
“Show!”. When the appropriate delay values are found they can be stored
in the on-board flash PROM by clicking “Do it!” separately for each
board. Clicking “Flash All!” will write the values to all boards at
once. Please note: Flashing the values might take up to 10 seconds
during which the program might not respond.</p>
<p><strong>Important note</strong>: If the application reports a “PLL not locked” error
check the cable. If the recording of histograms does not make progress
check the cable. Make sure the cable is properly terminated at both ends
and firmly attached to each card.</p>
<section id="calibration-procedure">
<h3>2.5.1 Calibration Procedure<a class="headerlink" href="#calibration-procedure" title="Permalink to this heading"></a></h3>
<ol class="arabic simple">
<li><p>Make sure the “Automode” is selected.</p></li>
<li><p>Record the calibration histograms by pressing “Record histograms”.
The program will perform up to 200 measurements of the sync delay.
After accumulating some data, the delay values found are reported in
the column “AutoMmt”. The values can be verified by examining the
histogram that was recorded. A board’s histogram should look like the
one shown in Figure <a class="reference external" href="#fig:HistoUncalib">[fig:HistoUncalib]</a>.
During normal operation the delay will be adjusted such that the data
points accumulated roughly coincide with the vertical markers in the
upper panel. As the delay pattern is periodic valid delay values are
between 0 and 31. Thus, the delay value found by the auto measurement
should correspond to the distance between the vertical markers and
accumulated data points. Hint: When moving the mouse pointer across
the histogram the delay value of the current location is displayed.</p></li>
<li><p>After stopping the data acquisition, by pressing “Record Histograms”
again or waiting for 200 measurements to complete, the delay values
of the auto measurement need to be copied to the columns “Delay M” or
“Delay S” depending on the corresponding board being a master or a
slave. The correct field to copy the value to is highlighted in
green.</p></li>
<li><p>You may record a new dataset as a crosscheck that the delay is now
set to an appropriate value. By disabling “Automode” the new delay
values are used. Press “Record Histograms” in order to start the data
acquisition. After some time the histogram should look similar to the
one in Figure <a class="reference external" href="#fig:HistoCalib">[fig:HistoCalib]</a>.</p></li>
<li><p>The delay values for all boards in a set needs to be found. For the
case a board acts as a master, the value “Delay M” needs to be
adjusted, in case it is a slave, the “Delay S” parameter needs to be
changed. In order to find the master-case delay values for all
boards, the calibration procedure needs to be performed with every
board acting as a master once. After changing the master board, the
slave values of the other boards don’t need to be readjusted. Only
Ndigo5G boards may be set as masters. Therefore, a Ndigo250M board
only needs to be calibrated as a slave.</p></li>
<li><p>After finding all delay values, write the values to the on-board
flash PROMs by pressing “Flash All!”.</p></li>
</ol>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
</section>
<section id="synchronizing-a-ndgio5g-and-an-hptdc8-pci">
<h3>2.5.2 Synchronizing a Ndgio5G and an HPTDC8-PCI<a class="headerlink" href="#synchronizing-a-ndgio5g-and-an-hptdc8-pci" title="Permalink to this heading"></a></h3>
<p>In order to operate a Ndigo5G in sync with one ore more HPTDC8-PCI
boards, a board to board interconnection using a Ndigo Extension Board
needs to be done. The Ndigo Extension Board has four clock outputs. One
of them needs to be connected to the external clock input of the HPTDC
using a standard Lemo 00 cable. The Ndigo5G is connected to the Ndigo
Extension Board using the Samtec ribbon cable provided with the Ndigo
Extension Board. The signals used for synchronization of the boards are
transmitted by a standard 10pin ribbon cable connecting the Ndigo
Extension Board and the HPTDC. A schematic of all necessary connections
is shown in Figure <a class="reference external" href="#fig:InterconNdigo">[fig:InterconNdigo]</a>.</p>
<p>In principle the user can use the standard device drivers of the Ndigo5G
and the HPTDC8-PCI to perform data acquisition. It is, however,
recommended to use the cronoSync-library, which is a part of the
cronoTools provided with with the Ndigo5G device driver. CronoSync
offers an easy group-based access to the data recorded and handles the
synchronization of all cronologic data ac-quisition devices used. A
detailed description of cronoTools and cronoSync can be found in the
cronoTools user guide.</p>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
</section>
</section>
<section id="performing-a-firmware-update">
<h2>2.6 Performing a firmware update<a class="headerlink" href="#performing-a-firmware-update" title="Permalink to this heading"></a></h2>
<p>After installing the Ndigo device driver, a firmware update tool is
available. By choosing “NdigoFirmwareGUI.exe” a firmware update can be
performed. After invoking the application a window as shown in Figure
<a class="reference external" href="#fig:Firmware">[fig:Firmware]</a> will appear. The tool can be used for
updating the firmware and to create a backup of the on-board calibration
data of the Ndigo unit. If several boards are present, the one which is
going to be used can be selected in the upper left corner of the window.
Pressing the “Backup” buttons a backup of the firmware or the
calibration data will be created, respectively. In order to perform a
firmware update, chose the “.ndigorom”-file to used by pressing
“Browse”. The file contains the firmware PROMs for all boards of the
Ndigo product line. By pressing “Flash” the firmware is written to the
board. “Verify” can be used to compare the data stored inside the PROM
to the one inside a file.</p>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<p><strong>Important note:</strong> The new firmware will only be used after a power
cycle, i.e. after switching the PC (or Ndigo crate) off and back on. A
simple reboot is not sufficient. Therefore the information shown in the
upper half of the application window does not change right after
flashing a new firmware.</p>
<p>After flashing and shutting the PC or the crate off and on again it is
recommended to perform a window calibration. The tool
“WindowCalibration” is provided for that purpose within the driver
installation. The omission of the calibration process leads to longer
execution times of applications using that firmware, since the
calibration is performed then instead.</p>
</section>
<section id="calibrating-the-tdc">
<h2>2.7 Calibrating the TDC<a class="headerlink" href="#calibrating-the-tdc" title="Permalink to this heading"></a></h2>
<p>After each update of the Ndigo5G-10 firmware the TDC has to be
calibrated. The calibration is done with the tool “TDCCalibration.exe”
which is available after installing the Ndigo device driver. After
invoking the application a window as shown in Figure
<a class="reference external" href="#fig:Calib">[fig:Calib]</a> will appear.</p>
<div class="figure docutils container">
<div class="center docutils container">
<p>image</p>
</div>
</div>
<p>The calibration procedure is as follows:</p>
<ol class="arabic simple">
<li><p>Connect an external pulse signal to the Trigger input. The signal
should be low active with a frequency in the kHz range. It must not
be synchronized to the clock source of the Ndigo5G-10. The input
frequency must not exceed 10 MHz. The pulse low and high width has to
be at least 10ns each.</p></li>
<li><p>Set <em>Serial Number</em> according to the sticker on the card if the shown
value is not correct.</p></li>
<li><p>Start capturing pulse events by pressing the <em>Start</em> button.</p></li>
<li><p>Adjust the <em>Input Offset</em> so that <em>First Bin</em> is in the range of 4 to
16. If <em>First Bin</em> is less than 4, increment <em>Input Offset</em> by one.
If <em>First Bin</em> is greater than 16 decrement <em>Input Offset</em> by one.
Repeat increment/decrement until <em>First Bin</em> is in the range of 4 to
16. Depending on the firmware revision the <em>Input Offset</em> value for a
successful calibration may be in the range of 6 – 10 or 28 – 32.</p></li>
<li><p>When the <em>Write Calibration Data</em> button becomes enabled press it to
update the calibration data on the card.</p></li>
<li><p>Calibration done!</p></li>
</ol>
<p>The card can only be successfully calibrated if:</p>
<ul class="simple">
<li><p><em>First Bin</em> is in the range of 4 to 16</p></li>
<li><p><em>Empty Bins</em> is less than (First Bin + 4)</p></li>
<li><p>at least 10,000 events have been captured</p></li>
<li><p>a valid serial number is set.</p></li>
</ul>
<p><strong>Important note:</strong> If the application reports an error check if the
input pulse is within specification.</p>
</section>
<section id="id3">
<h2>2.3 Extension Card<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h2>
<p>The Ndigo Extension card provides additional inputs or outputs to the
FPGA. It is connected to the C1(Samtec QSS-025) connector on an <strong>Ndigo5G</strong> by
an Samtec SQCD cable assembly.</p>
<p>The <strong>Ndigo Extension Card</strong> provides up to ten single ended LEMO00
connectors. The circuit connecting to each of these circuits can be
chosen to provide inputs or outputs. These can be AC or DC coupled. AC
coupled inputs support NIM signaling.</p>
<p>The signals connect to 2.5V IO Pins of the Xilinx Virtex-5 FPGA.
The current firmware revision provides the following signal connections.</p>
<p>Table</p>
<p>The 4 digital inputs are routed to the bus inputs of the trigger matrix
to be used for triggering. The routing can be configured to either ORing
the sync bus and extension channels or use the extension channels
exclusively.</p>
<p>Table</p>
</section>
<section id="id4">
<h2>2.4 Ndigo5G Functionality<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h2>
<section id="id5">
<h3>2.4.1 ADC Modes<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h3>
<p>Depending on board configuration, the analog input signal is quantized
to 8 or 10 bits. However, the board always scales and offsets the data
to 16 bit signed data centered around 0.</p>
<p>Data processing such as trigger detection or packet building are always
performed on <strong>3.2ns</strong> intervals. Depending on the ADC mode, this interval
may contain 4, 8 or 16 samples.</p>
<p>The board supports using one, two or four channels:</p>
<section id="id6">
<h4>1 Channel Modes A, B, C and D<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h4>
<p>In these modes, only a single channel is used. The analog signal on that
channel is digitized at 5Gsps. Packet size is always a multiple of 16
samples per <strong>3.2ns</strong>. See <a class="reference external" href="#target-link5">Figure 2.9</a>
on page and <a class="reference external" href="#target-link6">Figure 2.15</a> on page.</p>
</section>
<section id="id7">
<h4>2 Channel Modes AC, BC, AD and BD<a class="headerlink" href="#id7" title="Permalink to this heading"></a></h4>
<p>In these modes, two channels are used simultaneously. The analog signals
on these channels are digitized at <strong>2.5Gsps</strong> each. Packet size is always a
multiple of 8 samples per <strong>3.2ns</strong>. See <a class="reference external" href="#target-link7">Fig2.8</a> on page 11
and see <a class="reference external" href="#target-link8">Fig2.14</a> on page 14.</p>
</section>
<section id="id8">
<h4>4 Channel Mode ABCD<a class="headerlink" href="#id8" title="Permalink to this heading"></a></h4>
<p>In this mode, all four channels are digitized independently at <strong>1.25Gsps</strong>
each. The packet size is always a multiple of 4 samples per <strong>3.2ns</strong>. See
<a class="reference external" href="#target-link9">Fig2.7</a> on page 11 and see <a class="reference external" href="#target-link10">Fig2.13</a> on page 14.</p>
</section>
<section id="id9">
<h4>Multiple Sampling Modes AAAA, BBBB, CCCC and DDDD<a class="headerlink" href="#id9" title="Permalink to this heading"></a></h4>
<p>In these modes, only one analog input channel is used, but the channel
is sampled independently and simultaneously by four ADCs at <strong>1.25Gsps</strong>.
The board creates four independent streams with 4 samples each per
<strong>3.2ns</strong>.</p>
<p>Using the same trigger setting on all ADCs, can be used to reduce noise
by averaging the four channels. To deal with complex triggering
conditions, different trigger settings on each of the ADCs can be used.</p>
<p>The <strong>Ndigo5G</strong> provides 4 ADCs sampling at <strong>1.25Gsps</strong> each. Higher speed
modes are implemented by interleaving two or four of these ADCs.</p>
<p>During interleaving, the <strong>Ndigo5G</strong> firmware reorders and groups the data
into a linear sample stream. The process is fully transparent. For
users, the only difference is that a <strong>3.2ns</strong> cycle can contain 4, 8 or 16
samples, depending on mode.</p>
<figure class="align-default" id="id23">
<span id="target-link9"></span><a class="reference internal image-reference" href="_images/fig2.7.png"><img alt="alternative text" src="_images/fig2.7.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.7: ADCs in 4 channel mode ABCD at 1.25Gsps.</span><a class="headerlink" href="#id23" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id24">
<span id="target-link7"></span><a class="reference internal image-reference" href="_images/fig2.8.png"><img alt="alternative text" src="_images/fig2.8.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.8: ADCs in 2 channel mode AD, interleaved for 2.5Gsps.</span><a class="headerlink" href="#id24" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id25">
<span id="target-link5"></span><a class="reference internal image-reference" href="_images/fig2.9.png"><img alt="alternative text" src="_images/fig2.9.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.9: ADCs in 1 channel mode A, B, C or D interleaved for 5Gsps.</span><a class="headerlink" href="#id25" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="id10">
<h3>2.4.2 Zero Suppression<a class="headerlink" href="#id10" title="Permalink to this heading"></a></h3>
<p>One of <strong>Ndigo5G’s</strong> key features is on-board zero suppression to reduce
PCIe bus load. Only data that passes specifications predefined by the
user is transmitted. This guide refers to transmitted waveform data as
“packets”. A packet contains the waveform data and a timestamp giving
the absolute time (i.e. the time since start of data acquisition) of the
packet’s last sample.</p>
<p>Figure <a class="reference external" href="#target-link11">Fig 2.10</a> shows a simple example: Data
is written to the PC only if values exceed a specified threshold.
Expanding on that, <strong>Ndigo5G’s</strong> zero suppression can be used to realize
much more complex scenarios.</p>
<figure class="align-default" id="id26">
<span id="target-fig8"></span><a class="reference internal image-reference" href="_images/fig2.10.png"><img alt="alternative text" src="_images/fig2.10.png" style="width: 1500px; height: 250px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.10: Simple zero suppression: Only data
with values above a threshold are written to the PC.</span><a class="headerlink" href="#id26" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="id11">
<h3>2.4.3 Trigger Blocks<a class="headerlink" href="#id11" title="Permalink to this heading"></a></h3>
<p><strong>Ndigo5G-10</strong> and <strong>Ndigo5G-8</strong> record analog waveforms using zero suppression.
Whenever a relevant waveform is detected, data is written to an internal
FIFO memory. Each ADC channel has one trigger block determining whether
data is written to the FIFO. The parameters are set in Structure
<a href="#id12"><span class="problematic" id="id13">**</span></a>ndigo_trigger_block**(See chapter 3.4.3 on page 36).</p>
<p>Each trigger block consists of two independent units that check the
incoming raw data stream for trigger conditions (<a class="reference external" href="#target-link11">Fig 2.10</a> on page 12). Users can specify a
threshold and can choose whether triggering is used whenever incoming
data is below or above the threshold (level triggering) or only if data
exceeds the threshold (edge triggering).</p>
<p>A gate length can be set to extend the trigger window by multiples of
<strong>3.2ns</strong>. Furthermore, if users choose precursor values &gt; 0, the
trigger unit will start writing data to the FIFO precursor
3:2ns before the trigger event.</p>
<p>When using edge triggering, all packets have the same length (<a class="reference external" href="#target-link12">Fig 2.11</a> on page 13):
precursor + length + 1 cycles of <strong>3.2ns</strong>. For level
triggering, packet length is data dependent (<a class="reference external" href="#target-link13">Fig 2.12</a> on page 14).</p>
<p>Please note that triggering is not accurate to sample. For each <strong>3.2ns</strong>
clock cycle, it is determined whether on any sample during that clock
cycle a trigger condition is met. The clock cycle is then selected as
the trigger point. As a result, the trigger sample can be anywhere
within a range of up to 16 samples in single channel mode (<a class="reference external" href="#target-link6">Fig 2.15</a>  on page 15 ) at 16
samples per <strong>3.2ns</strong>.</p>
<p>If retriggering is active, the current trigger window is extended if a
trigger event is detected inside the window.</p>
<p>A trigger block can use several input sources:</p>
<ul class="simple">
<li><p>the 8 trigger decision units of all four ADC channels (<a class="reference external" href="#target-link14">Fig 2.16</a> on page 15)</p></li>
<li><p>the GATE input (<a class="reference external" href="#target-link4">Fig 2.17</a> on page 15)</p></li>
<li><p>the Trigger or TDC input, (<a class="reference external" href="#target-link4">Fig 2.17</a> on page 15 )</p></li>
<li><p>a function trigger providing random or periodic triggering (Section 2.4.5
on page 20)</p></li>
<li><p>triggers originating from other cards connected with the sync cable
or from the Ndigo Extension card (BUS0, BUS1, BUS2, BUS3)</p></li>
<li><p>A second set of trigger units with names ending in pe for the digital
inputs Trigger, GATE, BUS0, BUS1, BUS2, and BUS3 configured for
positive edge triggering. Together with the regular trigger units on
this inputs, both edges of a pulse can be used in the trigger logic.
This set of triggers is not available as inputs for the gate blocks.</p></li>
</ul>
<p>Trigger inputs from the above sources can be concatenated using logical
OR (<a class="reference external" href="#target-link15">Fig 2.19</a> on page 16) by
setting the appropriate bits in the trigger blocks source mask.</p>
<p>Triggers can be fed into the gate blocks described on page (<a class="reference external" href="#target-link16">Fig 2.20</a> Gate blocks can be used to
block writing data to the FIFO. That way, only zero suppressed data
occurring when the selected gate is active is transmitted. This
procedure reduces PCIe bus load even further (<a class="reference external" href="#target-link16">Fig 2.20</a> ).</p>
<figure class="align-default" id="id27">
<span id="target-link11"></span><a class="reference internal image-reference" href="_images/fig2.10.png"><img alt="alternative text" src="_images/fig2.10.png" style="width: 1500px; height: 250px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.10: Simple zero suppression: Only data
with values above a threshold are written to the PC.</span><a class="headerlink" href="#id27" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id28">
<span id="target-link12"></span><a class="reference internal image-reference" href="_images/fig2.11.png"><img alt="_images/fig2.11.png" src="_images/fig2.11.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.11: Parameters for edge triggering</span><a class="headerlink" href="#id28" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id29">
<span id="target-link13"></span><a class="reference internal image-reference" href="_images/fig2.12.png"><img alt="_images/fig2.12.png" src="_images/fig2.12.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.12: Parameters for level triggering</span><a class="headerlink" href="#id29" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id30">
<span id="target-link10"></span><a class="reference internal image-reference" href="_images/fig2.13.png"><img alt="_images/fig2.13.png" src="_images/fig2.13.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.13: Triggering in 4 channel mode at 4 samples per clock cycle.</span><a class="headerlink" href="#id30" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id31">
<span id="target-link8"></span><a class="reference internal image-reference" href="_images/fig2.14.png"><img alt="_images/fig2.14.png" src="_images/fig2.14.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.14: Triggering in 2 channel mode at 8 samples per clock cycle.</span><a class="headerlink" href="#id31" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id32">
<span id="target-link6"></span><a class="reference internal image-reference" href="_images/fig2.15.png"><img alt="_images/fig2.15.png" src="_images/fig2.15.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.15: Triggering in 1 channel mode at 16 samples per clock cycle.</span><a class="headerlink" href="#id32" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id33">
<span id="target-link14"></span><a class="reference internal image-reference" href="_images/fig2.16.png"><img alt="_images/fig2.16.png" src="_images/fig2.16.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.16: From the ADC inputs, a trigger unit creates an input flag for
the trigger matrix. Each digitizer channel (A, B, C, D) has two trigger units.</span><a class="headerlink" href="#id33" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id34">
<span id="target-link4"></span><a class="reference internal image-reference" href="_images/fig2.17.png"><img alt="_images/fig2.17.png" src="_images/fig2.17.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.17: The digital inputs Trigger, GATE,
BUS0, BUS1, BUS2 and BUS3 have simpler trigger units.</span><a class="headerlink" href="#id34" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id35">
<a class="reference internal image-reference" href="_images/fig2.18.png"><img alt="_images/fig2.18.png" src="_images/fig2.18.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.18: The extension block combines signals from
the optional extension board and the sync cable.</span><a class="headerlink" href="#id35" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id36">
<span id="target-link15"></span><a class="reference internal image-reference" href="_images/fig2.19.png"><img alt="_images/fig2.19.png" src="_images/fig2.19.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.19: Trigger Matrix: The trigger signals of each ADC channel, the trigger
input, the GATE input or the sync cable can be combined to create a
trigger input for each trigger block. The four gate signals can be used
to suppress triggers during certain time frames.</span><a class="headerlink" href="#id36" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id37">
<span id="target-link16"></span><a class="reference internal image-reference" href="_images/fig2.20.png"><img alt="_images/fig2.20.png" src="_images/fig2.20.png" style="width: 2000px; height: 300px;" /></a>
<figcaption>
<p><span class="caption-text">Figure 2.20: Gating Blocks: Each gating block can use an arbitrary combination
of inputs to trigger its state machine. The outputs can be individually
inverted and routed to the AND-gate feeding the trigger blocks.</span><a class="headerlink" href="#id37" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Sulima.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>