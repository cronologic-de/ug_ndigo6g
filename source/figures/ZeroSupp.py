import numpy as np
import matplotlib.pyplot as plt

# requires atompy v 4.20.0
# get it via github
# pip git+https://github.com/frekm/atompy.git@v4.20.0
import atompy as ap

X, Y = np.array(
    [
        [0.019167, 0.048126],
        [0.021481, 0.049085],
        [0.023791, 0.050523],
        [0.026102, 0.051801],
        [0.028418, 0.052441],
        [0.030728, 0.053879],
        [0.033039, 0.055317],
        [0.035349, 0.056756],
        [0.037658, 0.058354],
        [0.039968, 0.059792],
        [0.042279, 0.061071],
        [0.044590, 0.062509],
        [0.046898, 0.064267],
        [0.049207, 0.065865],
        [0.051514, 0.067783],
        [0.053824, 0.069222],
        [0.056132, 0.070980],
        [0.058438, 0.073057],
        [0.060744, 0.075135],
        [0.063052, 0.076893],
        [0.065358, 0.078971],
        [0.067661, 0.081368],
        [0.069967, 0.083445],
        [0.072273, 0.085523],
        [0.074574, 0.088240],
        [0.076878, 0.090637],
        [0.079182, 0.093034],
        [0.081483, 0.095751],
        [0.083783, 0.098788],
        [0.086085, 0.101345],
        [0.088384, 0.104382],
        [0.090683, 0.107578],
        [0.092982, 0.110614],
        [0.095277, 0.114290],
        [0.097574, 0.117646],
        [0.099869, 0.121322],
        [0.102164, 0.124998],
        [0.104457, 0.128993],
        [0.106749, 0.132989],
        [0.109039, 0.137464],
        [0.111335, 0.140980],
        [0.113639, 0.143217],
        [0.115974, 0.141113],
        [0.117411, 0.134454],
        [0.118490, 0.125957],
        [0.119304, 0.117806],
        [0.120294, 0.108750],
        [0.121288, 0.099161],
        [0.122281, 0.089572],
        [0.123275, 0.079983],
        [0.124263, 0.071193],
        [0.125252, 0.062270],
        [0.126311, 0.054336],
        [0.127367, 0.045432],
        [0.128051, 0.071359],
        [0.127895, 0.060272],
        [0.128432, 0.083445],
        [0.128825, 0.093834],
        [0.128992, 0.103423],
        [0.129610, 0.114810],
        [0.130048, 0.128309],
        [0.130371, 0.139222],
        [0.130765, 0.149503],
        [0.131159, 0.159678],
        [0.131480, 0.170889],
        [0.131931, 0.182532],
        [0.132320, 0.193453],
        [0.132709, 0.204507],
        [0.133102, 0.214816],
        [0.133426, 0.225683],
        [0.133941, 0.237555],
        [0.134266, 0.248217],
        [0.134662, 0.258179],
        [0.135059, 0.268035],
        [0.135444, 0.279522],
        [0.135901, 0.291874],
        [0.135995, 0.300797],
        [0.136689, 0.310729],
        [0.137014, 0.321414],
        [0.137401, 0.332661],
        [0.137859, 0.344881],
        [0.138184, 0.353857],
        [0.138643, 0.364268],
        [0.138964, 0.375432],
        [0.139439, 0.385235],
        [0.139537, 0.393492],
        [0.140212, 0.406277],
        [0.140543, 0.416026],
        [0.141004, 0.426140],
        [0.141402, 0.437442],
        [0.141869, 0.448363],
        [0.142117, 0.457259],
        [0.142522, 0.465889],
        [0.142922, 0.475265],
        [0.143376, 0.486414],
        [0.143848, 0.498172],
        [0.144247, 0.507761],
        [0.144496, 0.516551],
        [0.144972, 0.526140],
        [0.145285, 0.536848],
        [0.145685, 0.546278],
        [0.146239, 0.555707],
        [0.146484, 0.565136],
        [0.146882, 0.574725],
        [0.147281, 0.584314],
        [0.147682, 0.593424],
        [0.148084, 0.602533],
        [0.148485, 0.611803],
        [0.148886, 0.620912],
        [0.149287, 0.630182],
        [0.149692, 0.638812],
        [0.150095, 0.647762],
        [0.150498, 0.656712],
        [0.150899, 0.665821],
        [0.151301, 0.674931],
        [0.151707, 0.683401],
        [0.152114, 0.691712],
        [0.152522, 0.700022],
        [0.152928, 0.708492],
        [0.153334, 0.716963],
        [0.153742, 0.725114],
        [0.154149, 0.733424],
        [0.154557, 0.741735],
        [0.154965, 0.749885],
        [0.155439, 0.759741],
        [0.155757, 0.769703],
        [0.156317, 0.778386],
        [0.157098, 0.788508],
        [0.157416, 0.798630],
        [0.157818, 0.807579],
        [0.158222, 0.816369],
        [0.159156, 0.826864],
        [0.159479, 0.836187],
        [0.159884, 0.844817],
        [0.160736, 0.855964],
        [0.161574, 0.869049],
        [0.162420, 0.881136],
        [0.163264, 0.893422],
        [0.164037, 0.906392],
        [0.164873, 0.918227],
        [0.165798, 0.929909],
        [0.166734, 0.940068],
        [0.167599, 0.949258],
        [0.168470, 0.957648],
        [0.169342, 0.965906],
        [0.170129, 0.975228],
        [0.171466, 0.983219],
        [0.172975, 0.991510],
        [0.175082, 0.997283],
        [0.177404, 0.996963],
        [0.179239, 0.990411],
        [0.180755, 0.981941],
        [0.181369, 0.973630],
        [0.182254, 0.966278],
        [0.183169, 0.956849],
        [0.183864, 0.945662],
        [0.184804, 0.932677],
        [0.185342, 0.921849],
        [0.185860, 0.913858],
        [0.186382, 0.905388],
        [0.186842, 0.894787],
        [0.187394, 0.883447],
        [0.188000, 0.872465],
        [0.188472, 0.861529],
        [0.189088, 0.848972],
        [0.189439, 0.838424],
        [0.189682, 0.829994],
        [0.190016, 0.819977],
        [0.190430, 0.807876],
        [0.191112, 0.795319],
        [0.191608, 0.785844],
        [0.191528, 0.777214],
        [0.192305, 0.766324],
        [0.192141, 0.755319],
        [0.192824, 0.743692],
        [0.193528, 0.731240],
        [0.193675, 0.720958],
        [0.193966, 0.712328],
        [0.194253, 0.704337],
        [0.194414, 0.694429],
        [0.195067, 0.687157],
        [0.195121, 0.679166],
        [0.195416, 0.669976],
        [0.195705, 0.661586],
        [0.195626, 0.652876],
        [0.196279, 0.645604],
        [0.196199, 0.636894],
        [0.197020, 0.627625],
        [0.197014, 0.617237],
        [0.197331, 0.607008],
        [0.197988, 0.599257],
        [0.198042, 0.591266],
        [0.198335, 0.582396],
        [0.198624, 0.574086],
        [0.198917, 0.565136],
        [0.199208, 0.556506],
        [0.199497, 0.548195],
        [0.199655, 0.538606],
        [0.200313, 0.530535],
        [0.200235, 0.521666],
        [0.201008, 0.511300],
        [0.200843, 0.500570],
        [0.201513, 0.490847],
        [0.202033, 0.482590],
        [0.202326, 0.473720],
        [0.202482, 0.464451],
        [0.203098, 0.455821],
        [0.203442, 0.446232],
        [0.203653, 0.434816],
        [0.204438, 0.421194],
        [0.205033, 0.407419],
        [0.205770, 0.390775],
        [0.205598, 0.402282],
        [0.206423, 0.383503],
        [0.206718, 0.374314],
        [0.206872, 0.365364],
        [0.207391, 0.357213],
        [0.207981, 0.347944],
        [0.208894, 0.337213],
        [0.209369, 0.325889],
        [0.209893, 0.317099],
        [0.210410, 0.309268],
        [0.211504, 0.296403],
        [0.211952, 0.287373],
        [0.212465, 0.280181],
        [0.213527, 0.271897],
        [0.214442, 0.262601],
        [0.215353, 0.253651],
        [0.216498, 0.244595],
        [0.217587, 0.236870],
        [0.219401, 0.231010],
        [0.220672, 0.243263],
        [0.220052, 0.222487],
        [0.220998, 0.253811],
        [0.221402, 0.262601],
        [0.220688, 0.231277],
        [0.221807, 0.271231],
        [0.222213, 0.279702],
        [0.222619, 0.288172],
        [0.223026, 0.296482],
        [0.223424, 0.306151],
        [0.223828, 0.314915],
        [0.224231, 0.323811],
        [0.224840, 0.337142],
        [0.224192, 0.329565],
        [0.225147, 0.346534],
        [0.225622, 0.357266],
        [0.226248, 0.366323],
        [0.228309, 0.406117],
        [0.226974, 0.386634],
        [0.228718, 0.414108],
        [0.229126, 0.422259],
        [0.229600, 0.432114],
        [0.229923, 0.441437],
        [0.230334, 0.449268],
        [0.231194, 0.459217],
        [0.231634, 0.472373],
        [0.231960, 0.482830],
        [0.232805, 0.494976],
        [0.233704, 0.508903],
        [0.234032, 0.519108],
        [0.234953, 0.529908],
        [0.235283, 0.539725],
        [0.236241, 0.550468],
        [0.237098, 0.562699],
        [0.237826, 0.575113],
        [0.238762, 0.585140],
        [0.239632, 0.593663],
        [0.240423, 0.602374],
        [0.241834, 0.609360],
        [0.244224, 0.612042],
        [0.246046, 0.607967],
        [0.246927, 0.601255],
        [0.248373, 0.593424],
        [0.248987, 0.584953],
        [0.249867, 0.578401],
        [0.250772, 0.570490],
        [0.251763, 0.561300],
        [0.252757, 0.551578],
        [0.253832, 0.541437],
        [0.254826, 0.531734],
        [0.255739, 0.522678],
        [0.256734, 0.512956],
        [0.257726, 0.503500],
        [0.258720, 0.493911],
        [0.259713, 0.484322],
        [0.260707, 0.474732],
        [0.261701, 0.465143],
        [0.262691, 0.456087],
        [0.263680, 0.447164],
        [0.264665, 0.438773],
        [0.265731, 0.429907],
        [0.266718, 0.421300],
        [0.267621, 0.413602],
        [0.269019, 0.404679],
        [0.270640, 0.390615],
        [0.271620, 0.382944],
        [0.272916, 0.374314],
        [0.274058, 0.365683],
        [0.275510, 0.356894],
        [0.276496, 0.348423],
        [0.277946, 0.339953],
        [0.278930, 0.331802],
        [0.280380, 0.323305],
        [0.281831, 0.314648],
        [0.283284, 0.305725],
        [0.284742, 0.296136],
        [0.286187, 0.288412],
        [0.287635, 0.280154],
        [0.289083, 0.272030],
        [0.290527, 0.264439],
        [0.291969, 0.257114],
        [0.293412, 0.249656],
        [0.294923, 0.241893],
        [0.296698, 0.234359],
        [0.298277, 0.226368],
        [0.300122, 0.218391],
        [0.302034, 0.210101],
        [0.303946, 0.202010],
        [0.305856, 0.194119],
        [0.307871, 0.185906],
        [0.309754, 0.180455],
        [0.310708, 0.174408],
        [0.312631, 0.168326],
        [0.314688, 0.162669],
        [0.316059, 0.156048],
        [0.318013, 0.151482],
        [0.319480, 0.146293],
        [0.321528, 0.141459],
        [0.323701, 0.133902],
        [0.325212, 0.128594],
        [0.327056, 0.124732],
        [0.329420, 0.118339],
        [0.331932, 0.112852],
        [0.333644, 0.106779],
        [0.335710, 0.103263],
        [0.338067, 0.097829],
        [0.340423, 0.092555],
        [0.342776, 0.087760],
        [0.345126, 0.083286],
        [0.347478, 0.078651],
        [0.349828, 0.074336],
        [0.352177, 0.070021],
        [0.354520, 0.066665],
        [0.356868, 0.062669],
        [0.359213, 0.058993],
        [0.361557, 0.055477],
        [0.363897, 0.052601],
        [0.366230, 0.050683],
        [0.368550, 0.050683],
        [0.370868, 0.051002],
        [0.373179, 0.052281],
        [0.375499, 0.052281],
        [0.377819, 0.052281],
        [0.380130, 0.053559],
        [0.382448, 0.053879],
        [0.384766, 0.054199],
        [0.387077, 0.055477],
        [0.389396, 0.055637],
        [0.391708, 0.056916],
        [0.394027, 0.057075],
        [0.396338, 0.058354],
        [0.398656, 0.058674],
        [0.400972, 0.059313],
        [0.403285, 0.060272],
        [0.405605, 0.060272],
        [0.407918, 0.061391],
        [0.410234, 0.061870],
        [0.412552, 0.062190],
        [0.414863, 0.063468],
        [0.417182, 0.063628],
        [0.419495, 0.064747],
        [0.421813, 0.065066],
        [0.424126, 0.066025],
        [0.426442, 0.066665],
        [0.428761, 0.066824],
        [0.431072, 0.068103],
        [0.433391, 0.068263],
        [0.435711, 0.068263],
        [0.438022, 0.069541],
        [0.440340, 0.069861],
        [0.442660, 0.069861],
        [0.444972, 0.071139],
        [0.447290, 0.071459],
        [0.449609, 0.071619],
        [0.451921, 0.072738],
        [0.454239, 0.073057],
        [0.456559, 0.073057],
        [0.458873, 0.073856],
        [0.461188, 0.074655],
        [0.463508, 0.074655],
        [0.465828, 0.074655],
        [0.468148, 0.074655],
        [0.470461, 0.075774],
        [0.472777, 0.076254],
        [0.475097, 0.076254],
        [0.477417, 0.076254],
        [0.479738, 0.076254],
        [0.482058, 0.076254],
        [0.484378, 0.076254],
        [0.486698, 0.076254],
        [0.489018, 0.076254],
        [0.491343, 0.075455],
        [0.493669, 0.074655],
        [0.495990, 0.074496],
        [0.498319, 0.073217],
        [0.500647, 0.071939],
        [0.502982, 0.069861],
        [0.505313, 0.068263],
        [0.507638, 0.067464],
        [0.509964, 0.066665],
        [0.512285, 0.066505],
        [0.514613, 0.065386],
        [0.516935, 0.065066],
        [0.519255, 0.065066],
        [0.521579, 0.064427],
        [0.523905, 0.063628],
        [0.526226, 0.063468],
        [0.528546, 0.063468],
        [0.530866, 0.063468],
        [0.533186, 0.063468],
        [0.535512, 0.062669],
        [0.537834, 0.062349],
        [0.540157, 0.061870],
        [0.542477, 0.061870],
        [0.544797, 0.061870],
        [0.547117, 0.061870],
        [0.549437, 0.061870],
        [0.551757, 0.061870],
        [0.554078, 0.061870],
        [0.556398, 0.061870],
        [0.558718, 0.061870],
        [0.561038, 0.061870],
        [0.563358, 0.061870],
        [0.565678, 0.061870],
        [0.567998, 0.061870],
        [0.570318, 0.061870],
        [0.572638, 0.061870],
        [0.574958, 0.061870],
        [0.577278, 0.061870],
        [0.579598, 0.061870],
        [0.581918, 0.061870],
        [0.584236, 0.062190],
        [0.586552, 0.062829],
        [0.588867, 0.063468],
        [0.591187, 0.063468],
        [0.593507, 0.063468],
        [0.595819, 0.064747],
        [0.598132, 0.065706],
        [0.600455, 0.065386],
        [0.602777, 0.065066],
        [0.605097, 0.065066],
        [0.607417, 0.065066],
        [0.609737, 0.065066],
        [0.612056, 0.065226],
        [0.614367, 0.066505],
        [0.616683, 0.067144],
        [0.618995, 0.068263],
        [0.621307, 0.069541],
        [0.623615, 0.071299],
        [0.625919, 0.073537],
        [0.628224, 0.075774],
        [0.630528, 0.078171],
        [0.632827, 0.081208],
        [0.635124, 0.084564],
        [0.637419, 0.088240],
        [0.639717, 0.091436],
        [0.642006, 0.096071],
        [0.644296, 0.100386],
        [0.646583, 0.105181],
        [0.648866, 0.110614],
        [0.651152, 0.115675],
        [0.653367, 0.121345],
        [0.655643, 0.127738],
        [0.658154, 0.134987],
        [0.660152, 0.141513],
        [0.662520, 0.149570],
        [0.664430, 0.156784],
        [0.666495, 0.163887],
        [0.668498, 0.172677],
        [0.670554, 0.181023],
        [0.672452, 0.190024],
        [0.674251, 0.198314],
        [0.675984, 0.206733],
        [0.677450, 0.215181],
        [0.679181, 0.223885],
        [0.680906, 0.233332],
        [0.682306, 0.241798],
        [0.683641, 0.250189],
        [0.684976, 0.258579],
        [0.686310, 0.266969],
        [0.687638, 0.276425],
        [0.688965, 0.285881],
        [0.690303, 0.293739],
        [0.691170, 0.302715],
        [0.692501, 0.311585],
        [0.693827, 0.321254],
        [0.694694, 0.330204],
        [0.696085, 0.340067],
        [0.697875, 0.355136],
        [0.697370, 0.346079],
        [0.699161, 0.365181],
        [0.700037, 0.374447],
        [0.700908, 0.382837],
        [0.701697, 0.391894],
        [0.702999, 0.405021],
        [0.703943, 0.414002],
        [0.704805, 0.423591],
        [0.705668, 0.433180],
        [0.706456, 0.442236],
        [0.707316, 0.452282],
        [0.708247, 0.463146],
        [0.709031, 0.472921],
        [0.709812, 0.483123],
        [0.710670, 0.493378],
        [0.711531, 0.504679],
        [0.712449, 0.515866],
        [0.713300, 0.527139],
        [0.714146, 0.539126],
        [0.714988, 0.551811],
        [0.715899, 0.563926],
        [0.716232, 0.573447],
        [0.717083, 0.584674],
        [0.717985, 0.598173],
        [0.718315, 0.608127],
        [0.719164, 0.619634],
        [0.720064, 0.633447],
        [0.720391, 0.643766],
        [0.721251, 0.653675],
        [0.721653, 0.662785],
        [0.722056, 0.671734],
        [0.722459, 0.680684],
        [0.723324, 0.689794],
        [0.723729, 0.698424],
        [0.724130, 0.707693],
        [0.724533, 0.716643],
        [0.724936, 0.725593],
        [0.725869, 0.736168],
        [0.726109, 0.746289],
        [0.727037, 0.757577],
        [0.727812, 0.770205],
        [0.728729, 0.781621],
        [0.729591, 0.791278],
        [0.731101, 0.796632],
        [0.732816, 0.794634],
        [0.733336, 0.786484],
        [0.733853, 0.778652],
        [0.734470, 0.769862],
        [0.735245, 0.759246],
        [0.736006, 0.746556],
        [0.736317, 0.736620],
        [0.736613, 0.727830],
        [0.737096, 0.718881],
        [0.737574, 0.709451],
        [0.738028, 0.699010],
        [0.738404, 0.689954],
        [0.738547, 0.680365],
        [0.739133, 0.669862],
        [0.739587, 0.657419],
        [0.740082, 0.648001],
        [0.740230, 0.639451],
        [0.740778, 0.628652],
        [0.740991, 0.616917],
        [0.741204, 0.605136],
        [0.741885, 0.592807],
        [0.742381, 0.583275],
        [0.742302, 0.574405],
        [0.742900, 0.564497],
        [0.743130, 0.554588],
        [0.743558, 0.546917],
        [0.743612, 0.538926],
        [0.744041, 0.532800],
        [0.744166, 0.525741],
        [0.744307, 0.516551],
        [0.744751, 0.508161],
        [0.744887, 0.499504],
        [0.745335, 0.490581],
        [0.745623, 0.482350],
        [0.745786, 0.472122],
        [0.746213, 0.464611],
        [0.746267, 0.456620],
        [0.746416, 0.447830],
        [0.746840, 0.440638],
        [0.746990, 0.431688],
        [0.747414, 0.424656],
        [0.747565, 0.415547],
        [0.748010, 0.405378],
        [0.748562, 0.391894],
        [0.748720, 0.382305],
        [0.749147, 0.374713],
        [0.749430, 0.366722],
        [0.749350, 0.358012],
        [0.749775, 0.350741],
        [0.749924, 0.341871],
        [0.750519, 0.332495],
        [0.750750, 0.322373],
        [0.751094, 0.313903],
        [0.751328, 0.303994],
        [0.751775, 0.295204],
        [0.752066, 0.286574],
        [0.752356, 0.278023],
        [0.752504, 0.269313],
        [0.752704, 0.261642],
        [0.752855, 0.252533],
        [0.753280, 0.245261],
        [0.753431, 0.236231],
        [0.753978, 0.225683],
        [0.754260, 0.214496],
        [0.754709, 0.205306],
        [0.755000, 0.196756],
        [0.755291, 0.188126],
        [0.755440, 0.179336],
        [0.755636, 0.172144],
        [0.756014, 0.163194],
        [0.756451, 0.154724],
        [0.757192, 0.147532],
        [0.759098, 0.140281],
        [0.760986, 0.135546],
        [0.763335, 0.131391],
        [0.765680, 0.127715],
        [0.768021, 0.124678],
        [0.770357, 0.122281],
        [0.772694, 0.119884],
        [0.775027, 0.117966],
        [0.777359, 0.116208],
        [0.779687, 0.115089],
        [0.782016, 0.113811],
        [0.784343, 0.112692],
        [0.786672, 0.111413],
        [0.789001, 0.110135],
        [0.791323, 0.109815],
        [0.793650, 0.108856],
        [0.795974, 0.108217],
        [0.798294, 0.108217],
        [0.800615, 0.108057],
        [0.802945, 0.106619],
        [0.805265, 0.106619],
        [0.807585, 0.106619],
        [0.809905, 0.106619],
        [0.812225, 0.106619],
        [0.814545, 0.106619],
        [0.816865, 0.106619],
        [0.819186, 0.106619],
        [0.821506, 0.106619],
        [0.823826, 0.106619],
        [0.826146, 0.106619],
        [0.828466, 0.106619],
        [0.830786, 0.106619],
        [0.833105, 0.106779],
        [0.835416, 0.108057],
        [0.837735, 0.108217],
        [0.840055, 0.108217],
        [0.842375, 0.108217],
        [0.844695, 0.108217],
        [0.847009, 0.109176],
        [0.849324, 0.109815],
        [0.851644, 0.109815],
        [0.853964, 0.109815],
        [0.856285, 0.109815],
        [0.858600, 0.110455],
        [0.860915, 0.111254],
        [0.863234, 0.111413],
        [0.865554, 0.111413],
        [0.867874, 0.111413],
        [0.870194, 0.111413],
        [0.872510, 0.112053],
        [0.874826, 0.112532],
        [0.877143, 0.113012],
        [0.879463, 0.113012],
        [0.881783, 0.113012],
        [0.884103, 0.113012],
        [0.886423, 0.113012],
        [0.888743, 0.113012],
        [0.891062, 0.113171],
        [0.893378, 0.113811],
        [0.895698, 0.113811],
        [0.898013, 0.114610],
        [0.900333, 0.114610],
        [0.902653, 0.114610],
        [0.904973, 0.114610],
        [0.907293, 0.114610],
        [0.909613, 0.114610],
        [0.911933, 0.114610],
        [0.914253, 0.114610],
        [0.916573, 0.114610],
        [0.918893, 0.114610],
        [0.921213, 0.114610],
        [0.923533, 0.114610],
        [0.925853, 0.114610],
        [0.928173, 0.114610],
        [0.930493, 0.114610],
        [0.932817, 0.114130],
        [0.935139, 0.113811],
        [0.937462, 0.113331],
        [0.939785, 0.113012],
        [0.942105, 0.113012],
        [0.944425, 0.113012],
        [0.946745, 0.113012],
        [0.949065, 0.113012],
        [0.951388, 0.112532],
        [0.953714, 0.111733],
        [0.956036, 0.111413],
        [0.958356, 0.111413],
        [0.960676, 0.111413],
        [0.963001, 0.110614],
        [0.965327, 0.109815],
        [0.967647, 0.109815],
        [0.969967, 0.109815],
        [0.972295, 0.108697],
        [0.974618, 0.108217],
        [0.976938, 0.108217],
        [0.979261, 0.107738],
        [0.981589, 0.106619],
        [0.983910, 0.106459],
        [0.986239, 0.105181],
        [0.988562, 0.104701],
        [0.990891, 0.103423],
        [0.993383, 0.100892],
        [0.994977, 0.099627],
    ]
).T

CRONOBLUE = "#376eb5"
CRONOORANGE = "#ed7800"
LW = 1.5
XRANGE = (X.min(), X.max())
YRANGE = (Y.min(), Y.max())

POSTCURSOR = 0.12
PRECURSOR = 0.07
THRESHOLD = 0.4


def find_crossing(x, y, threshold) -> tuple[float, ...]:
    """
    Finds the x-values where the y-values cross from below to above the threshold.

    Parameters
    ----------
    x : np.ndarray
        Array of x-values.
    y : np.ndarray
        Array of y-values.
    threshold : float
        Threshold value.

    Returns
    -------
    tuple
        Tuple of x-values where the y-values cross the threshold.
    """
    crossings = []
    for i in range(1, len(y)):
        if y[i - 1] < threshold <= y[i]:
            # Linear interpolation to find the approximate x-crossing point
            x_crossing = x[i - 1] + (x[i] - x[i - 1]) * (threshold - y[i - 1]) / (
                y[i] - y[i - 1]
            )
            crossings.append(x_crossing)
    return tuple(crossings)


def annotate(ax, start, stop, arrowprops):
    ax.annotate("", xytext=start, xy=stop, arrowprops=arrowprops, zorder=5)
    ax.plot(*start, "|", c=arrowprops["ec"], markersize=4.5, zorder=4)


def main():
    ap._set_theme_atompy("b", use_latex=False, use_serif=False)
    plt.rcParams["figure.figsize"] = 4.0, 3.0
    grey = plt.rcParams["axes.edgecolor"]

    ax0 = plt.subplot(211)
    ax1 = plt.subplot(212)
    axs = (ax0, ax1)

    crossings = find_crossing(X, Y, THRESHOLD)

    yarr = THRESHOLD + 0.1
    arrowprops = dict(arrowstyle="-|>", shrinkA=0, shrinkB=0, fc=CRONOORANGE)
    arrowprops["ec"] = arrowprops["fc"]
    annotate(ax0, (crossings[2], yarr), (crossings[2] + POSTCURSOR, yarr), arrowprops)
    arrowprops["fc"] = ap.PALETTE_OKABE_ITO[0]
    arrowprops["ec"] = arrowprops["fc"]
    annotate(ax0, (crossings[0], yarr), (crossings[0] + POSTCURSOR, yarr), arrowprops)
    annotate(ax0, (crossings[0], yarr), (crossings[0] - PRECURSOR, yarr), arrowprops)

    annotate(ax0, (crossings[4], yarr), (crossings[4] + POSTCURSOR, yarr), arrowprops)
    annotate(ax0, (crossings[4], yarr), (crossings[4] - PRECURSOR, yarr), arrowprops)

    ax0.plot(X, Y, c=CRONOBLUE, lw=LW, zorder=2)
    ax0.axhline(THRESHOLD, lw=0.8, ls="--", c=grey, zorder=3)

    ytxt = yarr + 0.2
    arrowprops = dict(arrowstyle="-", shrinkB=5.2, shrinkA=0, ec=CRONOORANGE)
    ax0.annotate(
        "Retrigger",
        xy=(0.27, yarr),
        xytext=(0.28, ytxt),
        arrowprops=arrowprops,
        color=CRONOORANGE,
    )
    arrowprops["ec"] = ap.PALETTE_OKABE_ITO[0]
    ax0.annotate(
        "Precursor",
        xy=(0.7, yarr),
        xytext=(0.7, ytxt),
        arrowprops=arrowprops,
        ha="right",
        color=ap.PALETTE_OKABE_ITO[0],
    )
    ax0.annotate(
        "Postcursor",
        xy=(0.76, yarr),
        xytext=(0.76, ytxt),
        arrowprops=arrowprops,
        ha="left",
        color=ap.PALETTE_OKABE_ITO[0],
    )

    fr0 = crossings[0] - PRECURSOR
    fr1 = crossings[4] - PRECURSOR
    mask0 = np.logical_and(fr0 < X, X < crossings[2] + POSTCURSOR)
    mask1 = np.logical_and(fr1 < X, X < crossings[4] + POSTCURSOR)

    ax1.plot(X[mask0], Y[mask0], c=CRONOBLUE, lw=LW)
    ax1.plot(X[mask1], Y[mask1], c=CRONOBLUE, lw=LW)

    ax1.axvline(fr0, c=CRONOORANGE, ls="--", lw=0.8)
    ax1.text(
        fr0 - 0.01,
        0.5,
        "Timestamp",
        rotation=90,
        va="center",
        ha="right",
        c=CRONOORANGE,
    )
    ax1.axvline(fr1, c=CRONOORANGE, ls="--", lw=0.8)
    ax1.text(
        fr1 - 0.01,
        0.5,
        "Timestamp",
        rotation=90,
        va="center",
        ha="right",
        c=CRONOORANGE,
    )

    for ax in axs:
        ax.set_box_aspect(1.0 / 4.0)
        ax.set_xlim(XRANGE)
        ax.set_ylim(0, 1.03)
        ax.set_xticks([])
        ax.set_yticks([])

    ap.make_me_nice(fix_figwidth=True)

    ap.savefig("*", ftype=("pdf", "svg"), dpi=192, transparent=True)


if __name__ == "__main__":
    main()
